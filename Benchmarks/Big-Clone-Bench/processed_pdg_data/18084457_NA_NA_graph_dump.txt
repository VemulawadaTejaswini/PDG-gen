Line_4 $$ Socket socket = getSocket() --> Line_6 $$ InputStream in = socket.getInputStream() [FD]
Line_7 $$ for (; ; ) --> Line_8 $$ FileTransferHeader header = FileTransferHeader.readHeader(in) [CD]
Line_6 $$ InputStream in = socket.getInputStream() --> Line_8 $$ FileTransferHeader header = FileTransferHeader.readHeader(in) [FD]
Line_7 $$ for (; ; ) --> Line_9 $$ if (header == null) [CD]
Line_8 $$ FileTransferHeader header = FileTransferHeader.readHeader(in) --> Line_9 $$ if (header == null) [FD]
Line_7 $$ for (; ; ) --> Line_10 $$ System.out.println("header: " + header) [CD]
Line_7 $$ for (; ; ) --> Line_11 $$ String[] parts = header.getFilename().getSegments() [CD]
Line_8 $$ FileTransferHeader header = FileTransferHeader.readHeader(in) --> Line_11 $$ String[] parts = header.getFilename().getSegments() [FD]
Line_7 $$ for (; ; ) --> Line_12 $$ String filename [CD]
Line_7 $$ for (; ; ) --> Line_13 $$ filename = "dl-" + parts[parts.length - 1] [CD]
Line_12 $$ String filename --> Line_13 $$ filename = "dl-" + parts[parts.length - 1] [FD]
Line_7 $$ for (; ; ) --> Line_14 $$ System.out.println("writing to file " + filename) [CD]
Line_7 $$ for (; ; ) --> Line_15 $$ long sum = 0 [CD]
Line_7 $$ for (; ; ) --> Line_16 $$ if (new File(filename).exists()) [CD]
Line_16 $$ if (new File(filename).exists()) --> Line_17 $$ FileInputStream fis = new FileInputStream(filename) [CD]
Line_16 $$ if (new File(filename).exists()) --> Line_18 $$ byte[] block = new byte[10] [CD]
Line_16 $$ if (new File(filename).exists()) --> Line_19 $$ for (int i = 0; i < block.length; ) [CD]
Line_19 $$ for (int i = 0; i < block.length; ) --> Line_20 $$ int count = fis.read(block) [CD]
Line_17 $$ FileInputStream fis = new FileInputStream(filename) --> Line_20 $$ int count = fis.read(block) [FD]
Line_18 $$ byte[] block = new byte[10] --> Line_20 $$ int count = fis.read(block) [FD]
Line_19 $$ for (int i = 0; i < block.length; ) --> Line_21 $$ if (count == -1) [CD]
Line_20 $$ int count = fis.read(block) --> Line_21 $$ if (count == -1) [FD]
Line_19 $$ for (int i = 0; i < block.length; ) --> Line_22 $$ i += count [CD]
Line_19 $$ for (int i = 0; i < block.length; ) --> Line_22 $$ i += count [FD]
Line_20 $$ int count = fis.read(block) --> Line_22 $$ i += count [FD]
Line_16 $$ if (new File(filename).exists()) --> Line_25 $$ summer.update(block, 0, 10) [CD]
Line_18 $$ byte[] block = new byte[10] --> Line_25 $$ summer.update(block, 0, 10) [FD]
Line_16 $$ if (new File(filename).exists()) --> Line_26 $$ sum = summer.getValue() [CD]
Line_15 $$ long sum = 0 --> Line_26 $$ sum = summer.getValue() [FD]
Line_7 $$ for (; ; ) --> Line_28 $$ FileChannel fileChannel = new FileOutputStream(filename).getChannel() [CD]
Line_7 $$ for (; ; ) --> Line_30 $$ outHeader.setHeaderType(FileTransferHeader.HEADERTYPE_ACK) [CD]
Line_7 $$ for (; ; ) --> Line_31 $$ outHeader.setIcbmMessageId(cookie) [CD]
Line_7 $$ for (; ; ) --> Line_32 $$ outHeader.setBytesReceived(0) [CD]
Line_7 $$ for (; ; ) --> Line_33 $$ outHeader.setReceivedChecksum(sum) [CD]
Line_15 $$ long sum = 0 --> Line_33 $$ outHeader.setReceivedChecksum(sum) [FD]
Line_26 $$ sum = summer.getValue() --> Line_33 $$ outHeader.setReceivedChecksum(sum) [FD]
Line_7 $$ for (; ; ) --> Line_34 $$ OutputStream socketOut = socket.getOutputStream() [CD]
Line_4 $$ Socket socket = getSocket() --> Line_34 $$ OutputStream socketOut = socket.getOutputStream() [FD]
Line_7 $$ for (; ; ) --> Line_35 $$ System.out.println("sending header: " + outHeader) [CD]
Line_7 $$ for (; ; ) --> Line_36 $$ outHeader.write(socketOut) [CD]
Line_7 $$ for (; ; ) --> Line_37 $$ for (int i = 0; i < header.getFileSize(); ) [CD]
Line_19 $$ for (int i = 0; i < block.length; ) --> Line_37 $$ for (int i = 0; i < header.getFileSize(); ) [FD]
Line_22 $$ i += count --> Line_37 $$ for (int i = 0; i < header.getFileSize(); ) [FD]
Line_8 $$ FileTransferHeader header = FileTransferHeader.readHeader(in) --> Line_37 $$ for (int i = 0; i < header.getFileSize(); ) [FD]
Line_37 $$ for (int i = 0; i < header.getFileSize(); ) --> Line_38 $$ long transferred = fileChannel.transferFrom(Channels.newChannel(in), 0, header.getFileSize() - i) [CD]
Line_6 $$ InputStream in = socket.getInputStream() --> Line_38 $$ long transferred = fileChannel.transferFrom(Channels.newChannel(in), 0, header.getFileSize() - i) [FD]
Line_8 $$ FileTransferHeader header = FileTransferHeader.readHeader(in) --> Line_38 $$ long transferred = fileChannel.transferFrom(Channels.newChannel(in), 0, header.getFileSize() - i) [FD]
Line_37 $$ for (int i = 0; i < header.getFileSize(); ) --> Line_39 $$ System.out.println("transferred " + transferred) [CD]
Line_37 $$ for (int i = 0; i < header.getFileSize(); ) --> Line_40 $$ if (transferred == -1) [CD]
Line_38 $$ long transferred = fileChannel.transferFrom(Channels.newChannel(in), 0, header.getFileSize() - i) --> Line_40 $$ if (transferred == -1) [FD]
Line_37 $$ for (int i = 0; i < header.getFileSize(); ) --> Line_41 $$ i += transferred [CD]
Line_37 $$ for (int i = 0; i < header.getFileSize(); ) --> Line_41 $$ i += transferred [FD]
Line_19 $$ for (int i = 0; i < block.length; ) --> Line_41 $$ i += transferred [FD]
Line_22 $$ i += count --> Line_41 $$ i += transferred [FD]
Line_38 $$ long transferred = fileChannel.transferFrom(Channels.newChannel(in), 0, header.getFileSize() - i) --> Line_41 $$ i += transferred [FD]
Line_7 $$ for (; ; ) --> Line_43 $$ System.out.println("finished transfer!") [CD]
Line_7 $$ for (; ; ) --> Line_44 $$ fileChannel.close() [CD]
Line_7 $$ for (; ; ) --> Line_46 $$ doneHeader.setHeaderType(FileTransferHeader.HEADERTYPE_RECEIVED) [CD]
Line_7 $$ for (; ; ) --> Line_47 $$ doneHeader.setFlags(doneHeader.getFlags() | FileTransferHeader.FLAG_DONE) [CD]
Line_7 $$ for (; ; ) --> Line_48 $$ doneHeader.setBytesReceived(doneHeader.getBytesReceived() + 1) [CD]
Line_7 $$ for (; ; ) --> Line_49 $$ doneHeader.setIcbmMessageId(cookie) [CD]
Line_7 $$ for (; ; ) --> Line_50 $$ doneHeader.setFilesLeft(doneHeader.getFilesLeft() - 1) [CD]
Line_7 $$ for (; ; ) --> Line_51 $$ doneHeader.write(socketOut) [CD]
Line_7 $$ for (; ; ) --> Line_52 $$ if (doneHeader.getFilesLeft() - 1 <= 0) [CD]
Line_52 $$ if (doneHeader.getFilesLeft() - 1 <= 0) --> Line_53 $$ socket.close() [CD]
Line_4 $$ Socket socket = getSocket() --> Line_53 $$ socket.close() [FD]
Line_22 $$ i += count --> Line_19 $$ for (int i = 0; i < block.length; ) [FD]
Line_41 $$ i += transferred --> Line_37 $$ for (int i = 0; i < header.getFileSize(); ) [FD]
