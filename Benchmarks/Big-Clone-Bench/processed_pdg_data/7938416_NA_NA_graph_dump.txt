Line_2 $$ public synchronized boolean copy(int idAnexo) --> Line_4 $$ Anexo anexo = selectById(idAnexo) [FD]
Line_5 $$ Authentication auth = SecurityContextHolder.getContext().getAuthentication() --> Line_6 $$ Usuario usuario = (Usuario) auth.getPrincipal() [FD]
Line_4 $$ Anexo anexo = selectById(idAnexo) --> Line_7 $$ if (anexo.getAssinado() == 1 && anexo.getIdAssinadoPor() != usuario.getIdUsuario()) [FD]
Line_6 $$ Usuario usuario = (Usuario) auth.getPrincipal() --> Line_7 $$ if (anexo.getAssinado() == 1 && anexo.getIdAssinadoPor() != usuario.getIdUsuario()) [FD]
Line_7 $$ if (anexo.getAssinado() == 1 && anexo.getIdAssinadoPor() != usuario.getIdUsuario()) --> Line_8 $$ deleteAnexoFromTemp(anexo) [CD]
Line_4 $$ Anexo anexo = selectById(idAnexo) --> Line_8 $$ deleteAnexoFromTemp(anexo) [FD]
Line_7 $$ if (anexo.getAssinado() == 1 && anexo.getIdAssinadoPor() != usuario.getIdUsuario()) --> Line_9 $$ return false [CD]
Line_6 $$ Usuario usuario = (Usuario) auth.getPrincipal() --> Line_11 $$ Carteira carteiraUsuario = carteiraService.selectById(usuario.getIdCarteira()) [FD]
Line_4 $$ Anexo anexo = selectById(idAnexo) --> Line_12 $$ DocumentoDetalhes documentoDetalhes = anexo.getDocumentoDetalhes() [FD]
Line_12 $$ DocumentoDetalhes documentoDetalhes = anexo.getDocumentoDetalhes() --> Line_13 $$ Set<Documento> documentos = documentoDetalhes.getDocumentosByCarteira() [FD]
Line_15 $$ for (Documento documento : documentos) --> Line_16 $$ Carteira carteiraDocumento = documento.getCarteira() [FD]
Line_16 $$ Carteira carteiraDocumento = documento.getCarteira() --> Line_17 $$ if (carteiraDocumento != null) [FD]
Line_17 $$ if (carteiraDocumento != null) --> Line_18 $$ if (carteiraDocumento.getIdCarteira() == carteiraUsuario.getIdCarteira()) [CD]
Line_16 $$ Carteira carteiraDocumento = documento.getCarteira() --> Line_18 $$ if (carteiraDocumento.getIdCarteira() == carteiraUsuario.getIdCarteira()) [FD]
Line_11 $$ Carteira carteiraUsuario = carteiraService.selectById(usuario.getIdCarteira()) --> Line_18 $$ if (carteiraDocumento.getIdCarteira() == carteiraUsuario.getIdCarteira()) [FD]
Line_18 $$ if (carteiraDocumento.getIdCarteira() == carteiraUsuario.getIdCarteira()) --> Line_19 $$ havePermission = true [CD]
Line_14 $$ boolean havePermission = false --> Line_19 $$ havePermission = true [FD]
Line_18 $$ if (carteiraDocumento.getIdCarteira() == carteiraUsuario.getIdCarteira()) --> Line_20 $$ System.out.println("tem permisssao: " + havePermission) [CD]
Line_14 $$ boolean havePermission = false --> Line_25 $$ if (!havePermission) [FD]
Line_19 $$ havePermission = true --> Line_25 $$ if (!havePermission) [FD]
Line_25 $$ if (!havePermission) --> Line_26 $$ System.out.println("Não tem permissao.") [CD]
Line_25 $$ if (!havePermission) --> Line_27 $$ return false [CD]
Line_4 $$ Anexo anexo = selectById(idAnexo) --> Line_29 $$ FileInputStream fis = new FileInputStream(new File(config.baseDir + "/temp/" + anexo.getAnexoCaminho())) [FD]
Line_4 $$ Anexo anexo = selectById(idAnexo) --> Line_30 $$ FileOutputStream fos = new FileOutputStream(new File(config.baseDir + "/arquivos_upload_direto/" + anexo.getAnexoCaminho())) [FD]
Line_29 $$ FileInputStream fis = new FileInputStream(new File(config.baseDir + "/temp/" + anexo.getAnexoCaminho())) --> Line_31 $$ IOUtils.copy(fis, fos) [FD]
Line_30 $$ FileOutputStream fos = new FileOutputStream(new File(config.baseDir + "/arquivos_upload_direto/" + anexo.getAnexoCaminho())) --> Line_31 $$ IOUtils.copy(fis, fos) [FD]
Line_4 $$ Anexo anexo = selectById(idAnexo) --> Line_32 $$ String txtHistorico = "(Edição) -" + anexo.getAnexoNome() + "-" [FD]
Line_32 $$ String txtHistorico = "(Edição) -" + anexo.getAnexoNome() + "-" --> Line_33 $$ txtHistorico += usuario.getUsuLogin() [FD]
Line_6 $$ Usuario usuario = (Usuario) auth.getPrincipal() --> Line_33 $$ txtHistorico += usuario.getUsuLogin() [FD]
Line_34 $$ Historico historico = new Historico() --> Line_35 $$ historico.setCarteira(carteiraUsuario) [FD]
Line_11 $$ Carteira carteiraUsuario = carteiraService.selectById(usuario.getIdCarteira()) --> Line_35 $$ historico.setCarteira(carteiraUsuario) [FD]
Line_34 $$ Historico historico = new Historico() --> Line_36 $$ historico.setDataHoraHistorico(new Date()) [FD]
Line_34 $$ Historico historico = new Historico() --> Line_37 $$ historico.setHistorico(txtHistorico) [FD]
Line_32 $$ String txtHistorico = "(Edição) -" + anexo.getAnexoNome() + "-" --> Line_37 $$ historico.setHistorico(txtHistorico) [FD]
Line_33 $$ txtHistorico += usuario.getUsuLogin() --> Line_37 $$ historico.setHistorico(txtHistorico) [FD]
Line_34 $$ Historico historico = new Historico() --> Line_38 $$ historico.setDocumentoDetalhes(documentoDetalhes) [FD]
Line_12 $$ DocumentoDetalhes documentoDetalhes = anexo.getDocumentoDetalhes() --> Line_38 $$ historico.setDocumentoDetalhes(documentoDetalhes) [FD]
Line_34 $$ Historico historico = new Historico() --> Line_39 $$ historico.setUsuario(usuario) [FD]
Line_6 $$ Usuario usuario = (Usuario) auth.getPrincipal() --> Line_39 $$ historico.setUsuario(usuario) [FD]
Line_34 $$ Historico historico = new Historico() --> Line_40 $$ historicoService.save(historico) [FD]
Line_4 $$ Anexo anexo = selectById(idAnexo) --> Line_41 $$ return deleteAnexoFromTemp(anexo) [FD]
