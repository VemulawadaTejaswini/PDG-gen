Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_3 $$ Writer out = null [CD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_4 $$ PreparedStatement ps = null [CD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_5 $$ DatabaseAdapter dbDyn = null [CD]
Line_3 $$ Writer out = null --> Line_7 $$ out = renderResponse.getWriter() [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_7 $$ out = renderResponse.getWriter() [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_9 $$ AuthSession auth_ = (AuthSession) renderRequest.getUserPrincipal() [FD]
Line_9 $$ AuthSession auth_ = (AuthSession) renderRequest.getUserPrincipal() --> Line_10 $$ if (auth_ == null || !auth_.isUserInRole("webmill.upload_image")) [FD]
Line_5 $$ DatabaseAdapter dbDyn = null --> Line_13 $$ dbDyn = DatabaseAdapter.getInstance() [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_14 $$ log.debug("urlString - " + renderRequest.getParameter("url_download")) [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_15 $$ String urlString = renderRequest.getParameter("url_download").trim() [FD]
Line_15 $$ String urlString = renderRequest.getParameter("url_download").trim() --> Line_16 $$ if (urlString == null) [FD]
Line_19 $$ int i --> Line_20 $$ for (i = 0; i < ext.length; i++) [FD]
Line_20 $$ for (i = 0; i < ext.length; i++) --> Line_21 $$ if ((ext[i] != null) && urlString.toLowerCase().endsWith(ext[i].toLowerCase())) [CD]
Line_15 $$ String urlString = renderRequest.getParameter("url_download").trim() --> Line_21 $$ if ((ext[i] != null) && urlString.toLowerCase().endsWith(ext[i].toLowerCase())) [FD]
Line_20 $$ for (i = 0; i < ext.length; i++) --> Line_23 $$ if (i == ext.length) [FD]
Line_19 $$ int i --> Line_23 $$ if (i == ext.length) [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_24 $$ log.debug("id_main - " + PortletService.getLong(renderRequest, "id_main")) [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_25 $$ Long id_main = PortletService.getLong(renderRequest, "id_main") [FD]
Line_25 $$ Long id_main = PortletService.getLong(renderRequest, "id_main") --> Line_26 $$ if (id_main == null) [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_27 $$ String desc = RequestTools.getString(renderRequest, "d") [FD]
Line_28 $$ CustomSequenceType seq = new CustomSequenceType() --> Line_29 $$ seq.setSequenceName("seq_image_number_file") [FD]
Line_28 $$ CustomSequenceType seq = new CustomSequenceType() --> Line_30 $$ seq.setTableName("MAIN_FORUM_THREADS") [FD]
Line_28 $$ CustomSequenceType seq = new CustomSequenceType() --> Line_31 $$ seq.setColumnName("ID_THREAD") [FD]
Line_5 $$ DatabaseAdapter dbDyn = null --> Line_32 $$ Long currID = dbDyn.getSequenceNextValue(seq) [FD]
Line_13 $$ dbDyn = DatabaseAdapter.getInstance() --> Line_32 $$ Long currID = dbDyn.getSequenceNextValue(seq) [FD]
Line_28 $$ CustomSequenceType seq = new CustomSequenceType() --> Line_32 $$ Long currID = dbDyn.getSequenceNextValue(seq) [FD]
Line_36 $$ URL url = new URL(urlString) --> Line_37 $$ File fileUrl = new File(url.getFile()) [FD]
Line_37 $$ File fileUrl = new File(url.getFile()) --> Line_39 $$ String newFileName = StringTools.appendString("" + currID, '0', 7, true) + "-" + fileUrl.getName() [FD]
Line_34 $$ String fileName = storage_ + File.separatorChar --> Line_41 $$ fileName += newFileName [FD]
Line_39 $$ String newFileName = StringTools.appendString("" + currID, '0', 7, true) + "-" + fileUrl.getName() --> Line_41 $$ fileName += newFileName [FD]
Line_36 $$ URL url = new URL(urlString) --> Line_43 $$ InputStream is = url.openStream() [FD]
Line_46 $$ int count = 0 --> Line_47 $$ while ((count = is.read(bytes)) != -1) [FD]
Line_43 $$ InputStream is = url.openStream() --> Line_47 $$ while ((count = is.read(bytes)) != -1) [FD]
Line_47 $$ while ((count = is.read(bytes)) != -1) --> Line_48 $$ fos.write(bytes, 0, count) [CD]
Line_47 $$ while ((count = is.read(bytes)) != -1) --> Line_48 $$ fos.write(bytes, 0, count) [FD]
Line_44 $$ FileOutputStream fos = new FileOutputStream(new File(fileName)) --> Line_48 $$ fos.write(bytes, 0, count) [FD]
Line_46 $$ int count = 0 --> Line_48 $$ fos.write(bytes, 0, count) [FD]
Line_44 $$ FileOutputStream fos = new FileOutputStream(new File(fileName)) --> Line_50 $$ fos.close() [FD]
Line_44 $$ FileOutputStream fos = new FileOutputStream(new File(fileName)) --> Line_51 $$ fos = null [FD]
Line_43 $$ InputStream is = url.openStream() --> Line_52 $$ is.close() [FD]
Line_43 $$ InputStream is = url.openStream() --> Line_53 $$ is = null [FD]
Line_36 $$ URL url = new URL(urlString) --> Line_54 $$ url = null [FD]
Line_3 $$ Writer out = null --> Line_55 $$ out.write(DateUtils.getCurrentDate("dd-MMMM-yyyy HH:mm:ss:SS", renderRequest.getLocale()) + "<br>") [FD]
Line_7 $$ out = renderResponse.getWriter() --> Line_55 $$ out.write(DateUtils.getCurrentDate("dd-MMMM-yyyy HH:mm:ss:SS", renderRequest.getLocale()) + "<br>") [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_55 $$ out.write(DateUtils.getCurrentDate("dd-MMMM-yyyy HH:mm:ss:SS", renderRequest.getLocale()) + "<br>") [FD]
Line_4 $$ PreparedStatement ps = null --> Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") [FD]
Line_5 $$ DatabaseAdapter dbDyn = null --> Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") [FD]
Line_13 $$ dbDyn = DatabaseAdapter.getInstance() --> Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") [FD]
Line_4 $$ PreparedStatement ps = null --> Line_57 $$ RsetTools.setLong(ps, 1, currID) [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_57 $$ RsetTools.setLong(ps, 1, currID) [FD]
Line_32 $$ Long currID = dbDyn.getSequenceNextValue(seq) --> Line_57 $$ RsetTools.setLong(ps, 1, currID) [FD]
Line_4 $$ PreparedStatement ps = null --> Line_58 $$ RsetTools.setLong(ps, 2, id_main) [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_58 $$ RsetTools.setLong(ps, 2, id_main) [FD]
Line_25 $$ Long id_main = PortletService.getLong(renderRequest, "id_main") --> Line_58 $$ RsetTools.setLong(ps, 2, id_main) [FD]
Line_4 $$ PreparedStatement ps = null --> Line_59 $$ ps.setString(3, "/image/" + newFileName) [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_59 $$ ps.setString(3, "/image/" + newFileName) [FD]
Line_4 $$ PreparedStatement ps = null --> Line_60 $$ ps.setString(4, desc) [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_60 $$ ps.setString(4, desc) [FD]
Line_27 $$ String desc = RequestTools.getString(renderRequest, "d") --> Line_60 $$ ps.setString(4, desc) [FD]
Line_4 $$ PreparedStatement ps = null --> Line_61 $$ ps.setString(5, auth_.getUserLogin()) [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_61 $$ ps.setString(5, auth_.getUserLogin()) [FD]
Line_9 $$ AuthSession auth_ = (AuthSession) renderRequest.getUserPrincipal() --> Line_61 $$ ps.setString(5, auth_.getUserLogin()) [FD]
Line_4 $$ PreparedStatement ps = null --> Line_62 $$ ps.executeUpdate() [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_62 $$ ps.executeUpdate() [FD]
Line_5 $$ DatabaseAdapter dbDyn = null --> Line_63 $$ dbDyn.commit() [FD]
Line_13 $$ dbDyn = DatabaseAdapter.getInstance() --> Line_63 $$ dbDyn.commit() [FD]
Line_3 $$ Writer out = null --> Line_64 $$ out.write("�������� ������ ������ ��� ������<br>" + "�������� ���� " + newFileName + "<br>" + DateUtils.getCurrentDate("dd-MMMM-yyyy HH:mm:ss:SS", renderRequest.getLocale()) + "<br>" + "<br>" + "<p><a href=\"" + PortletService.url("mill.image.index", renderRequest, renderResponse) + "\">��������� ������ ��������</a></p><br>" + "<p><a href=\"" + PortletService.url(ContainerConstants.CTX_TYPE_INDEX, renderRequest, renderResponse) + "\">�� ������� ��������</a></p>") [FD]
Line_7 $$ out = renderResponse.getWriter() --> Line_64 $$ out.write("�������� ������ ������ ��� ������<br>" + "�������� ���� " + newFileName + "<br>" + DateUtils.getCurrentDate("dd-MMMM-yyyy HH:mm:ss:SS", renderRequest.getLocale()) + "<br>" + "<br>" + "<p><a href=\"" + PortletService.url("mill.image.index", renderRequest, renderResponse) + "\">��������� ������ ��������</a></p><br>" + "<p><a href=\"" + PortletService.url(ContainerConstants.CTX_TYPE_INDEX, renderRequest, renderResponse) + "\">�� ������� ��������</a></p>") [FD]
Line_2 $$ public void render(RenderRequest renderRequest, RenderResponse renderResponse) throws PortletException --> Line_64 $$ out.write("�������� ������ ������ ��� ������<br>" + "�������� ���� " + newFileName + "<br>" + DateUtils.getCurrentDate("dd-MMMM-yyyy HH:mm:ss:SS", renderRequest.getLocale()) + "<br>" + "<br>" + "<p><a href=\"" + PortletService.url("mill.image.index", renderRequest, renderResponse) + "\">��������� ������ ��������</a></p><br>" + "<p><a href=\"" + PortletService.url(ContainerConstants.CTX_TYPE_INDEX, renderRequest, renderResponse) + "\">�� ������� ��������</a></p>") [FD]
Line_5 $$ DatabaseAdapter dbDyn = null --> Line_67 $$ dbDyn.rollback() [FD]
Line_13 $$ dbDyn = DatabaseAdapter.getInstance() --> Line_67 $$ dbDyn.rollback() [FD]
Line_70 $$ final String es = "Error upload image from url" --> Line_71 $$ log.error(es, e) [FD]
Line_5 $$ DatabaseAdapter dbDyn = null --> Line_74 $$ DatabaseManager.close(dbDyn, ps) [FD]
Line_13 $$ dbDyn = DatabaseAdapter.getInstance() --> Line_74 $$ DatabaseManager.close(dbDyn, ps) [FD]
Line_4 $$ PreparedStatement ps = null --> Line_74 $$ DatabaseManager.close(dbDyn, ps) [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_74 $$ DatabaseManager.close(dbDyn, ps) [FD]
Line_5 $$ DatabaseAdapter dbDyn = null --> Line_75 $$ dbDyn = null [FD]
Line_13 $$ dbDyn = DatabaseAdapter.getInstance() --> Line_75 $$ dbDyn = null [FD]
Line_4 $$ PreparedStatement ps = null --> Line_76 $$ ps = null [FD]
Line_56 $$ ps = dbDyn.prepareStatement("insert into WM_IMAGE_DIR " + "( id_image_dir, ID_FIRM, is_group, id, id_main, name_file, description )" + "(select seq_WM_IMAGE_DIR.nextval, ID_FIRM, 0, ?, ?, ?, ? " + " from WM_AUTH_USER where user_login = ? )") --> Line_76 $$ ps = null [FD]
