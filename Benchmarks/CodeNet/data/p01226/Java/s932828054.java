import java.util.*;class Main{public static void main(String[]z){Scanner s=new Scanner(System.in);String o,e="";for(int t=s.nextInt(),i,j,p,q,d,h,w;t-->0;){char[]m=new char[(h=s.nextInt())*(w=s.nextInt()+2)],x,a={60,62,94,118},b={76,82,85,68};int[]r={-1,1,-w,w};for(i=p=0;i<h;++i)for(j=0,x=s.next().toCharArray();j<w-2;++j)for(q=0;q<4;++q)if(a[q]==(m[i*w+j+1]=x[j]))p=i*w+j+1;s.next();o=s.next();for(char c:o.toCharArray())if(c==83){for(i=0;a[i]!=m[p];++i);d=r[i];for(q=p+d;0<q&&q<h*w&&(m[q]==45||m[q]==46);q+=d);if(0<q&&q<h*w&&m[q]==42)m[q]=46;}else for(i=4;i-->0;)if(c==b[i]){d=r[i];q=p+d;if(!(0<q&&q<h*w&&m[q]==46))q-=d;m[p]=46;m[p=q]=a[i];}for(i=0;i<h;++i,e+="\n")for(j=1;j<w-1;++j)e+=m[i*w+j];e+="\n";}System.out.println(e.replaceAll("\n$",""));}}