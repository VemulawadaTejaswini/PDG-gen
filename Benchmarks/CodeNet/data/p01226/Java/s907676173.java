

import java.io.IOException;
import java.util.Arrays;
import java.util.HashMap;
import java.util.Scanner;

/**
 * <pre>
 * ??????????????????
 * </pre>
 *
 * @author ?????????????????§???
 * @version 1.8_45
 * @since 1.8_45
 */
public class Main{

	public static void main(String[] args) throws NumberFormatException, IOException {

		// ?????????
		Scanner sc = new Scanner(System.in);
		// 1?????????????????????????????????????§????????????????????????°
		int data_set = sc.nextInt();
		// ??\?????????????????????????????????????????£?¨?
		String tmp_row;

		for (int cnt = 0; cnt < data_set; cnt++) {
			// ??????????????????
			int map_height = sc.nextInt();
			// ???????????????
			int map_width = sc.nextInt();
			// ????????¨???????????£?????????????????????
			String[][] game_Map = new String[map_height+2][map_width+2];

			//??°??????????????¨???????£?????????????
			 for (int wall = 0; wall < map_height + 2; wall++) {
	                Arrays.fill(game_Map[wall], "x");
	            }

			// ?????????????????????????????±???????´???´???
			int[] tank_pos = new int[2];
			String tank_dir = "";


			sc.nextLine();
			// ????????????????????°??¢?????\????????????
			for (int mh = 1; mh < map_height+1; mh++) {
				tmp_row = sc.nextLine();
				for (int mw = 0; mw < map_width; mw++) {

					// ??°??????????£?
					game_Map[mh][mw+1] = String.valueOf(tmp_row.charAt(mw));

					// ????????????????????±????????????????´?
					String chk_tank = game_Map[mh][mw];
					if (chk_tank.equals("^") || chk_tank.equals("v") || chk_tank.equals("<") || chk_tank.equals(">")) {
						tank_pos[0] = mh;
						tank_pos[1] = mw;
						tank_dir = chk_tank;
					}
				}
			}
			// ???????????????????????±
			Tank tank = new Tank(game_Map, tank_pos, tank_dir);

			sc.nextLine();
			// ?????????????????????
			tmp_row = sc.nextLine();
			for (char cmd : tmp_row.toCharArray()) {
				tank.command(cmd);
			}
			// ??????????????¨??°?????\??????
			tank.tankLastPosition();
			data_set--;

			// ??°??¢?????????
			for (int ch = 0; ch < map_height; ch++) {
				for (int cw = 0; cw < map_width; cw++) {
					System.out.print(game_Map[ch][cw]);
				}
				System.out.println();
			}
			if (data_set > 0)
				System.out.println();
		}

	}// ?????????????????????????????????

	static class Tank {

		/**
		 * ?????????
		 */
		private String[][] map;
		/**
		 * ??????????????¨??°
		 */
		private int[] pos;
		/**
		 * ??????
		 */
		private String dir;

		/*
		 * ????????????????????????
		 */
		Tank(String[][] game_Map, int[] tank_pos, String tank_dir) {
			map = game_Map;
			pos = tank_pos;
			dir = tank_dir;
		}

		/*
		 * ?§??????????
		 */
		static HashMap<String, String> move_Cmd = new HashMap<String, String>() {
			{
				// ?????????????????????
				put("U", "^");
				// ?????????????????????
				put("D", "v");
				// ?????????????????????
				put("L", "<");
				// ?????????????????????
				put("R", ">");
			}
		};

		/*
		 * ????????¢???
		 */
		static HashMap<String, int[]> move_Dir = new HashMap<String, int[]>() {
			{
				put("^", new int[] { -1, 0 });
				put("v", new int[] { 1, 0 });
				put("<", new int[] { 0, -1 });
				put(">", new int[] { 0, 1 });
			}
		};

		void command(char cmd) {

			if (cmd != 'S') {
				move_tank(String.valueOf(cmd));
			} else {
				cannon_Shoot();
			}
		}

		// ?????????
		private void cannon_Shoot() {
			int[] shell = new int[] { this.pos[0], this.pos[1] };
			while (true) {
				shell[0] += move_Dir.get(this.dir)[0];
				shell[1] += move_Dir.get(this.dir)[1];
				switch (map[shell[0]][shell[1]]) {
				case ".":
				case "-":
					continue;
				case "*":
					map[shell[0]][shell[1]] = ".";
				case "#":
				case "x":
				}
				break;
			}

		}

		// ?????????
		private void move_tank(String cmd) {

			  this.dir = move_Cmd.get(cmd);
		        int[] move = new int[]{this.pos[0], this.pos[1]};
		        move[0] += move_Dir.get(this.dir)[0];
		        move[1] += move_Dir.get(this.dir)[1];
		        if (map[move[0]][move[1]] == ".") {
		            this.pos[0] = move[0];
		            this.pos[1] = move[1];
		        }
		}

		// // ?????????
		void tankLastPosition() {
			map[this.pos[0]][this.pos[1]] = this.dir;
		}

	}// Tank?????????????????????
}// ???????????????????????????????????????