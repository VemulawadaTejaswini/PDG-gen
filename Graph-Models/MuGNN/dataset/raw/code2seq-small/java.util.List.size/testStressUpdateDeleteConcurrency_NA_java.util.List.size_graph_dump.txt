Line_87 $$ UpdateRequest ur = client().prepareUpdate("test", "type1", Integer.toString(j)).setScript(new Script("field", ScriptService.ScriptType.INLINE, "field_inc", null)).setRetryOnConflict(retryOnConflict).setUpsert(jsonBuilder().startObject().field("field", 1).endObject()).request()-->Line_88 $$ client().update(ur, new UpdateListener(j))[ FD ]
Line_10 $$ final CountDownLatch latch = new CountDownLatch(numberOfThreads)-->Line_163 $$ latch.await()[ FD ]
Line_184 $$ if (response.isExists()) -->Line_192 $$ expectedVersion -= totalFailures[ CD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_160 $$ threads.add(ut)[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_44 $$ updateRequestsOutstanding.release(1)[ CD ]
Line_184 $$ if (response.isExists()) -->Line_186 $$ int expectedVersion = (numberOfThreads * numberOfUpdatesPerId * 2) + 1[ CD ]
Line_188 $$ if (ut.failedMap.containsKey(i)) -->Line_189 $$ totalFailures += ut.failedMap.get(i)[ CD ]
Line_184 $$ if (response.isExists()) -->Line_193 $$ logger.error("Actual version [[ CD ]
Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) -->Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()[ CD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_12 $$ final List<Throwable> failures = new CopyOnWriteArrayList()[ CD ]
Line_158 $$ UpdateThread ut = new UpdateThread(numberOfIdsPerThread, numberOfUpdatesPerId)-->Line_159 $$ ut.start()[ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) [ CD ]
Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) -->Line_189 $$ totalFailures += ut.failedMap.get(i)[ FD ]
Line_186 $$ int expectedVersion = (numberOfThreads * numberOfUpdatesPerId * 2) + 1-->Line_192 $$ expectedVersion -= totalFailures[ FD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) [ FD ]
Line_182 $$ int totalFailures = 0-->Line_189 $$ totalFailures += ut.failedMap.get(i)[ FD ]
Line_144 $$ long msRemaining = timeOut.getMillis() - (System.currentTimeMillis() - start)-->Line_145 $$ logger.info("[[ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_163 $$ latch.await()[ CD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_7 $$ final int numberOfIdsPerThread = scaledRandomIntBetween(3, 10)[ CD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_5 $$ ensureGreen()[ CD ]
Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()-->Line_185 $$ assertThat(response.getId(), equalTo(Integer.toString(i)))[ FD ]
Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) -->Line_185 $$ assertThat(response.getId(), equalTo(Integer.toString(i)))[ FD ]
Line_182 $$ int totalFailures = 0-->Line_192 $$ expectedVersion -= totalFailures[ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_8 $$ final int numberOfUpdatesPerId = scaledRandomIntBetween(10, 100)[ CD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_136 $$ map.put(j, 0)[ FD ]
Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()-->Line_184 $$ if (response.isExists()) [ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_180 $$ refresh()[ CD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_162 $$ startLatch.countDown()[ CD ]
Line_11 $$ final CountDownLatch startLatch = new CountDownLatch(1)-->Line_162 $$ startLatch.countDown()[ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_10 $$ final CountDownLatch latch = new CountDownLatch(numberOfThreads)[ CD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_158 $$ UpdateThread ut = new UpdateThread(numberOfIdsPerThread, numberOfUpdatesPerId)[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_138 $$ map.put(j, map.get(j) + 1)[ CD ]
Line_7 $$ final int numberOfIdsPerThread = scaledRandomIntBetween(3, 10)-->Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) [ FD ]
Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()-->Line_194 $$ assertThat(response.getVersion(), equalTo((long) expectedVersion))[ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_52 $$ updateRequestsOutstanding.release(1)[ CD ]
Line_135 $$ if (!map.containsKey(j)) -->Line_136 $$ map.put(j, 0)[ CD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_103 $$ DeleteRequest dr = client().prepareDelete("test", "type1", Integer.toString(j)).request()[ FD ]
Line_192 $$ expectedVersion -= totalFailures-->Line_193 $$ logger.error("Actual version [[ FD ]
Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()-->Line_193 $$ logger.error("Actual version [[ FD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_185 $$ assertThat(response.getId(), equalTo(Integer.toString(i)))[ FD ]
Line_144 $$ long msRemaining = timeOut.getMillis() - (System.currentTimeMillis() - start)-->Line_147 $$ requestsOutstanding.tryAcquire(maxRequests, msRemaining, TimeUnit.MILLISECONDS)[ FD ]
Line_182 $$ int totalFailures = 0-->Line_193 $$ logger.error("Actual version [[ FD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_108 $$ incrementMapValue(j, failedMap)[ FD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_178 $$ UpdateResponse ur = client().prepareUpdate("test", "type1", Integer.toString(i)).setScript(new Script("field", ScriptService.ScriptType.INLINE, "field_inc", null)).setRetryOnConflict(Integer.MAX_VALUE).setUpsert(jsonBuilder().startObject().field("field", 1).endObject()).execute().actionGet()[ FD ]
Line_143 $$ do -->Line_145 $$ logger.info("[[ CD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_6 $$ final int numberOfThreads = scaledRandomIntBetween(3, 5)[ CD ]
Line_10 $$ final CountDownLatch latch = new CountDownLatch(numberOfThreads)-->Line_130 $$ latch.countDown()[ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_66 $$ deleteRequestsOutstanding.release(1)[ CD ]
Line_143 $$ do -->Line_144 $$ long msRemaining = timeOut.getMillis() - (System.currentTimeMillis() - start)[ CD ]
Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) -->Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()[ FD ]
Line_12 $$ final List<Throwable> failures = new CopyOnWriteArrayList()-->Line_128 $$ failures.add(ete)[ FD ]
Line_189 $$ totalFailures += ut.failedMap.get(i)-->Line_193 $$ logger.error("Actual version [[ FD ]
Line_103 $$ DeleteRequest dr = client().prepareDelete("test", "type1", Integer.toString(j)).request()-->Line_104 $$ client().delete(dr, new DeleteListener(j))[ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_142 $$ long start = System.currentTimeMillis()[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_121 $$ logger.error("Something went wrong", e)[ FD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_189 $$ totalFailures += ut.failedMap.get(i)[ FD ]
Line_6 $$ final int numberOfThreads = scaledRandomIntBetween(3, 5)-->Line_157 $$ for (int i = 0; i < numberOfThreads; i++) [ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_173 $$ assertThat(failures.size(), equalTo(0))[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_145 $$ logger.info("[[ FD ]
Line_82 $$ boolean hasWaitedForNoNode = false-->Line_98 $$ hasWaitedForNoNode = true[ FD ]
Line_98 $$ hasWaitedForNoNode = true-->Line_114 $$ hasWaitedForNoNode = true[ FD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_159 $$ ut.start()[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_136 $$ map.put(j, 0)[ FD ]
Line_184 $$ if (response.isExists()) -->Line_194 $$ assertThat(response.getVersion(), equalTo((long) expectedVersion))[ CD ]
Line_189 $$ totalFailures += ut.failedMap.get(i)-->Line_192 $$ expectedVersion -= totalFailures[ FD ]
Line_84 $$ for (int k = 0; k < numberOfUpdatesPerId; ++k) -->Line_85 $$ updateRequestsOutstanding.acquire()[ CD ]
Line_158 $$ UpdateThread ut = new UpdateThread(numberOfIdsPerThread, numberOfUpdatesPerId)-->Line_160 $$ threads.add(ut)[ FD ]
Line_8 $$ final int numberOfUpdatesPerId = scaledRandomIntBetween(10, 100)-->Line_84 $$ for (int k = 0; k < numberOfUpdatesPerId; ++k) [ FD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_84 $$ for (int k = 0; k < numberOfUpdatesPerId; ++k) [ CD ]
Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()-->Line_195 $$ assertThat(response.getVersion() + totalFailures, equalTo((long) ((numberOfUpdatesPerId * numberOfThreads * 2) + 1)))[ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_157 $$ for (int i = 0; i < numberOfThreads; i++) [ CD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_135 $$ if (!map.containsKey(j)) [ FD ]
Line_184 $$ if (response.isExists()) -->Line_185 $$ assertThat(response.getId(), equalTo(Integer.toString(i)))[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_122 $$ failures.add(e)[ FD ]
Line_11 $$ final CountDownLatch startLatch = new CountDownLatch(1)-->Line_81 $$ startLatch.await()[ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_143 $$ do [ CD ]
Line_12 $$ final List<Throwable> failures = new CopyOnWriteArrayList()-->Line_173 $$ assertThat(failures.size(), equalTo(0))[ FD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_188 $$ if (ut.failedMap.containsKey(i)) [ FD ]
Line_157 $$ for (int i = 0; i < numberOfThreads; i++) -->Line_183 $$ GetResponse response = client().prepareGet("test", "type1", Integer.toString(i)).execute().actionGet()[ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_9 $$ final int retryOnConflict = randomIntBetween(0, 1)[ CD ]
Line_9 $$ final int retryOnConflict = randomIntBetween(0, 1)-->Line_87 $$ UpdateRequest ur = client().prepareUpdate("test", "type1", Integer.toString(j)).setScript(new Script("field", ScriptService.ScriptType.INLINE, "field_inc", null)).setRetryOnConflict(retryOnConflict).setUpsert(jsonBuilder().startObject().field("field", 1).endObject()).request()[ FD ]
Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) -->Line_184 $$ if (response.isExists()) [ CD ]
Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) -->Line_188 $$ if (ut.failedMap.containsKey(i)) [ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_144 $$ long msRemaining = timeOut.getMillis() - (System.currentTimeMillis() - start)[ FD ]
Line_2 $$ public void testStressUpdateDeleteConcurrency() throws Exception -->Line_11 $$ final CountDownLatch startLatch = new CountDownLatch(1)[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_135 $$ if (!map.containsKey(j)) [ FD ]
Line_186 $$ int expectedVersion = (numberOfThreads * numberOfUpdatesPerId * 2) + 1-->Line_193 $$ logger.error("Actual version [[ FD ]
Line_12 $$ final List<Throwable> failures = new CopyOnWriteArrayList()-->Line_122 $$ failures.add(e)[ FD ]
Line_184 $$ if (response.isExists()) -->Line_195 $$ assertThat(response.getVersion() + totalFailures, equalTo((long) ((numberOfUpdatesPerId * numberOfThreads * 2) + 1)))[ CD ]
Line_82 $$ boolean hasWaitedForNoNode = false-->Line_114 $$ hasWaitedForNoNode = true[ FD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_87 $$ UpdateRequest ur = client().prepareUpdate("test", "type1", Integer.toString(j)).setScript(new Script("field", ScriptService.ScriptType.INLINE, "field_inc", null)).setRetryOnConflict(retryOnConflict).setUpsert(jsonBuilder().startObject().field("field", 1).endObject()).request()[ FD ]
Line_181 $$ for (int i = 0; i < numberOfIdsPerThread; ++i) -->Line_182 $$ int totalFailures = 0[ CD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_92 $$ incrementMapValue(j, failedMap)[ FD ]
Line_83 $$ for (int j = 0; j < numberOfIds; j++) -->Line_138 $$ map.put(j, map.get(j) + 1)[ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_138 $$ map.put(j, map.get(j) + 1)[ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_143 $$ do [ FD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_74 $$ deleteRequestsOutstanding.release(1)[ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_135 $$ if (!map.containsKey(j)) [ CD ]
Line_13 $$ final class UpdateThread extends Thread -->Line_147 $$ requestsOutstanding.tryAcquire(maxRequests, msRemaining, TimeUnit.MILLISECONDS)[ FD ]
