Line_14 $$ if (LOG.isDebugEnabled()) -->Line_15 $$ LOG.debug("Block (=" + lastblock + ") not found")[ CD ]
Line_43 $$ if (remove) -->Line_44 $$ blockManager.removeBlockFromMap(storedBlock)[ CD ]
Line_73 $$ if (closeFile) -->Line_77 $$ persistBlocks(src, iFile, false)[ CD ]
Line_63 $$ for (int i = 0; i < trimmedTargets.size(); i++) -->Line_65 $$ if (storageInfo != null) [ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_6 $$ waitForLoadingFSImage()[ CD ]
Line_50 $$ ArrayList<String> trimmedStorages = new ArrayList<String>(newtargets.length)-->Line_70 $$ DatanodeStorageInfo[] trimmedStorageInfos = blockManager.getDatanodeManager().getDatanodeStorageInfos(trimmedTargets.toArray(new DatanodeID[trimmedTargets.size()]), trimmedStorages.toArray(new String[trimmedStorages.size()]))[ FD ]
Line_50 $$ ArrayList<String> trimmedStorages = new ArrayList<String>(newtargets.length)-->Line_56 $$ trimmedStorages.add(newtargetstorages[i])[ FD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_83 $$ if (closeFile) [ CD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_44 $$ blockManager.removeBlockFromMap(storedBlock)[ FD ]
Line_40 $$ if (deleteblock) -->Line_47 $$ storedBlock.setGenerationStamp(newgenerationstamp)[ CD ]
Line_5 $$ String src = ""-->Line_77 $$ persistBlocks(src, iFile, false)[ FD ]
Line_52 $$ for (int i = 0; i < newtargets.length; ++i) -->Line_54 $$ if (targetNode != null) [ CD ]
Line_52 $$ for (int i = 0; i < newtargets.length; ++i) -->Line_53 $$ DatanodeDescriptor targetNode = blockManager.getDatanodeManager().getDatanode(newtargets[i])[ CD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_12 $$ if (storedBlock == null) [ FD ]
Line_30 $$ if (!iFile.isUnderConstruction() || storedBlock.isComplete()) -->Line_31 $$ if (LOG.isDebugEnabled()) [ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_5 $$ String src = ""[ CD ]
Line_53 $$ DatanodeDescriptor targetNode = blockManager.getDatanodeManager().getDatanode(newtargets[i])-->Line_54 $$ if (targetNode != null) [ FD ]
Line_57 $$ if (LOG.isDebugEnabled()) -->Line_58 $$ LOG.debug("DatanodeDescriptor (=" + newtargets[i] + ") not found")[ CD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_71 $$ iFile.setLastBlock(storedBlock, trimmedStorageInfos)[ FD ]
Line_40 $$ if (deleteblock) -->Line_70 $$ DatanodeStorageInfo[] trimmedStorageInfos = blockManager.getDatanodeManager().getDatanodeStorageInfos(trimmedTargets.toArray(new DatanodeID[trimmedTargets.size()]), trimmedStorages.toArray(new String[trimmedStorages.size()]))[ CD ]
Line_5 $$ String src = ""-->Line_76 $$ src = iFile.getFullPathName()[ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_74 $$ src = closeFileCommitBlocks(iFile, storedBlock)[ FD ]
Line_31 $$ if (LOG.isDebugEnabled()) -->Line_32 $$ LOG.debug("Unexpected block (=" + lastblock + ") since the file (=" + iFile.getLocalName() + ") is not under construction")[ CD ]
Line_40 $$ if (deleteblock) -->Line_41 $$ Block blockToDel = ExtendedBlock.getLocalBlock(lastblock)[ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_37 $$ if (recoveryId != newgenerationstamp) [ FD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_30 $$ if (!iFile.isUnderConstruction() || storedBlock.isComplete()) [ FD ]
Line_40 $$ if (deleteblock) -->Line_43 $$ if (remove) [ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_47 $$ storedBlock.setGenerationStamp(newgenerationstamp)[ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_76 $$ src = iFile.getFullPathName()[ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_27 $$ if (isFileDeleted(iFile)) [ FD ]
Line_63 $$ for (int i = 0; i < trimmedTargets.size(); i++) -->Line_64 $$ DatanodeStorageInfo storageInfo = trimmedTargets.get(i).getStorageInfo(trimmedStorages.get(i))[ CD ]
Line_40 $$ if (deleteblock) -->Line_42 $$ boolean remove = iFile.removeLastBlock(blockToDel)[ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_84 $$ LOG.info("commitBlockSynchronization(newblock=" + lastblock + ", file=" + src + ", newgenerationstamp=" + newgenerationstamp + ", newlength=" + newlength + ", newtargets=" + Arrays.asList(newtargets) + ") successful")[ FD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_74 $$ src = closeFileCommitBlocks(iFile, storedBlock)[ FD ]
Line_30 $$ if (!iFile.isUnderConstruction() || storedBlock.isComplete()) -->Line_34 $$ return[ CD ]
Line_49 $$ ArrayList<DatanodeDescriptor> trimmedTargets = new ArrayList<DatanodeDescriptor>(newtargets.length)-->Line_63 $$ for (int i = 0; i < trimmedTargets.size(); i++) [ FD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_48 $$ storedBlock.setNumBytes(newlength)[ FD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_3 $$ LOG.info("commitBlockSynchronization(lastblock=" + lastblock + ", newgenerationstamp=" + newgenerationstamp + ", newlength=" + newlength + ", newtargets=" + Arrays.asList(newtargets) + ", closeFile=" + closeFile + ", deleteBlock=" + deleteblock + ")")[ FD ]
Line_41 $$ Block blockToDel = ExtendedBlock.getLocalBlock(lastblock)-->Line_42 $$ boolean remove = iFile.removeLastBlock(blockToDel)[ FD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_47 $$ storedBlock.setGenerationStamp(newgenerationstamp)[ FD ]
Line_40 $$ if (deleteblock) -->Line_49 $$ ArrayList<DatanodeDescriptor> trimmedTargets = new ArrayList<DatanodeDescriptor>(newtargets.length)[ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_7 $$ writeLock()[ CD ]
Line_12 $$ if (storedBlock == null) -->Line_13 $$ if (deleteblock) [ CD ]
Line_63 $$ for (int i = 0; i < trimmedTargets.size(); i++) -->Line_64 $$ DatanodeStorageInfo storageInfo = trimmedTargets.get(i).getStorageInfo(trimmedStorages.get(i))[ FD ]
Line_83 $$ if (closeFile) -->Line_84 $$ LOG.info("commitBlockSynchronization(newblock=" + lastblock + ", file=" + src + ", newgenerationstamp=" + newgenerationstamp + ", newlength=" + newlength + ", newtargets=" + Arrays.asList(newtargets) + ") successful")[ CD ]
Line_36 $$ long recoveryId = ((BlockInfoUnderConstruction) storedBlock).getBlockRecoveryId()-->Line_37 $$ if (recoveryId != newgenerationstamp) [ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_42 $$ boolean remove = iFile.removeLastBlock(blockToDel)[ FD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_71 $$ iFile.setLastBlock(storedBlock, trimmedStorageInfos)[ FD ]
Line_40 $$ if (deleteblock) -->Line_48 $$ storedBlock.setNumBytes(newlength)[ CD ]
Line_73 $$ if (closeFile) -->Line_74 $$ src = closeFileCommitBlocks(iFile, storedBlock)[ CD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_66 $$ storageInfo.addBlock(storedBlock)[ FD ]
Line_13 $$ if (deleteblock) -->Line_17 $$ return[ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_48 $$ storedBlock.setNumBytes(newlength)[ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_77 $$ persistBlocks(src, iFile, false)[ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_28 $$ throw new FileNotFoundException("File not found: " + iFile.getFullPathName() + ", likely due to delayed block" + " removal")[ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_30 $$ if (!iFile.isUnderConstruction() || storedBlock.isComplete()) [ FD ]
Line_40 $$ if (deleteblock) -->Line_50 $$ ArrayList<String> trimmedStorages = new ArrayList<String>(newtargets.length)[ CD ]
Line_54 $$ if (targetNode != null) -->Line_55 $$ trimmedTargets.add(targetNode)[ CD ]
Line_49 $$ ArrayList<DatanodeDescriptor> trimmedTargets = new ArrayList<DatanodeDescriptor>(newtargets.length)-->Line_62 $$ if ((closeFile) && !trimmedTargets.isEmpty()) [ FD ]
Line_64 $$ DatanodeStorageInfo storageInfo = trimmedTargets.get(i).getStorageInfo(trimmedStorages.get(i))-->Line_66 $$ storageInfo.addBlock(storedBlock)[ FD ]
Line_65 $$ if (storageInfo != null) -->Line_66 $$ storageInfo.addBlock(storedBlock)[ CD ]
Line_76 $$ src = iFile.getFullPathName()-->Line_77 $$ persistBlocks(src, iFile, false)[ FD ]
Line_51 $$ if (newtargets.length > 0) -->Line_52 $$ for (int i = 0; i < newtargets.length; ++i) [ CD ]
Line_40 $$ if (deleteblock) -->Line_62 $$ if ((closeFile) && !trimmedTargets.isEmpty()) [ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_3 $$ LOG.info("commitBlockSynchronization(lastblock=" + lastblock + ", newgenerationstamp=" + newgenerationstamp + ", newlength=" + newlength + ", newtargets=" + Arrays.asList(newtargets) + ", closeFile=" + closeFile + ", deleteBlock=" + deleteblock + ")")[ CD ]
Line_62 $$ if ((closeFile) && !trimmedTargets.isEmpty()) -->Line_63 $$ for (int i = 0; i < trimmedTargets.size(); i++) [ CD ]
Line_49 $$ ArrayList<DatanodeDescriptor> trimmedTargets = new ArrayList<DatanodeDescriptor>(newtargets.length)-->Line_70 $$ DatanodeStorageInfo[] trimmedStorageInfos = blockManager.getDatanodeManager().getDatanodeStorageInfos(trimmedTargets.toArray(new DatanodeID[trimmedTargets.size()]), trimmedStorages.toArray(new String[trimmedStorages.size()]))[ FD ]
Line_73 $$ if (closeFile) -->Line_76 $$ src = iFile.getFullPathName()[ CD ]
Line_13 $$ if (deleteblock) -->Line_14 $$ if (LOG.isDebugEnabled()) [ CD ]
Line_74 $$ src = closeFileCommitBlocks(iFile, storedBlock)-->Line_77 $$ persistBlocks(src, iFile, false)[ FD ]
Line_74 $$ src = closeFileCommitBlocks(iFile, storedBlock)-->Line_76 $$ src = iFile.getFullPathName()[ FD ]
Line_22 $$ BlockCollection blockCollection = storedBlock.getBlockCollection()-->Line_23 $$ if (blockCollection == null) [ FD ]
Line_83 $$ if (closeFile) -->Line_86 $$ LOG.info("commitBlockSynchronization(" + lastblock + ") successful")[ CD ]
Line_54 $$ if (targetNode != null) -->Line_57 $$ if (LOG.isDebugEnabled()) [ CD ]
Line_54 $$ if (targetNode != null) -->Line_56 $$ trimmedStorages.add(newtargetstorages[i])[ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_41 $$ Block blockToDel = ExtendedBlock.getLocalBlock(lastblock)[ FD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))[ FD ]
Line_40 $$ if (deleteblock) -->Line_51 $$ if (newtargets.length > 0) [ CD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_82 $$ getEditLog().logSync()[ CD ]
Line_5 $$ String src = ""-->Line_74 $$ src = closeFileCommitBlocks(iFile, storedBlock)[ FD ]
Line_49 $$ ArrayList<DatanodeDescriptor> trimmedTargets = new ArrayList<DatanodeDescriptor>(newtargets.length)-->Line_55 $$ trimmedTargets.add(targetNode)[ FD ]
Line_70 $$ DatanodeStorageInfo[] trimmedStorageInfos = blockManager.getDatanodeManager().getDatanodeStorageInfos(trimmedTargets.toArray(new DatanodeID[trimmedTargets.size()]), trimmedStorages.toArray(new String[trimmedStorages.size()]))-->Line_71 $$ iFile.setLastBlock(storedBlock, trimmedStorageInfos)[ FD ]
Line_53 $$ DatanodeDescriptor targetNode = blockManager.getDatanodeManager().getDatanode(newtargets[i])-->Line_55 $$ trimmedTargets.add(targetNode)[ FD ]
Line_2 $$ void commitBlockSynchronization(ExtendedBlock lastblock, long newgenerationstamp, long newlength, boolean closeFile, boolean deleteblock, DatanodeID[] newtargets, String[] newtargetstorages) throws IOException, UnresolvedLinkException -->Line_4 $$ checkOperation(OperationCategory.WRITE)[ CD ]
Line_40 $$ if (deleteblock) -->Line_71 $$ iFile.setLastBlock(storedBlock, trimmedStorageInfos)[ CD ]
Line_52 $$ for (int i = 0; i < newtargets.length; ++i) -->Line_64 $$ DatanodeStorageInfo storageInfo = trimmedTargets.get(i).getStorageInfo(trimmedStorages.get(i))[ FD ]
Line_26 $$ INodeFile iFile = ((INode) blockCollection).asFile()-->Line_32 $$ LOG.debug("Unexpected block (=" + lastblock + ") since the file (=" + iFile.getLocalName() + ") is not under construction")[ FD ]
Line_11 $$ final BlockInfo storedBlock = getStoredBlock(ExtendedBlock.getLocalBlock(lastblock))-->Line_22 $$ BlockCollection blockCollection = storedBlock.getBlockCollection()[ FD ]
Line_49 $$ ArrayList<DatanodeDescriptor> trimmedTargets = new ArrayList<DatanodeDescriptor>(newtargets.length)-->Line_64 $$ DatanodeStorageInfo storageInfo = trimmedTargets.get(i).getStorageInfo(trimmedStorages.get(i))[ FD ]
Line_50 $$ ArrayList<String> trimmedStorages = new ArrayList<String>(newtargets.length)-->Line_64 $$ DatanodeStorageInfo storageInfo = trimmedTargets.get(i).getStorageInfo(trimmedStorages.get(i))[ FD ]
Line_64 $$ DatanodeStorageInfo storageInfo = trimmedTargets.get(i).getStorageInfo(trimmedStorages.get(i))-->Line_65 $$ if (storageInfo != null) [ FD ]
Line_52 $$ for (int i = 0; i < newtargets.length; ++i) -->Line_63 $$ for (int i = 0; i < trimmedTargets.size(); i++) [ FD ]
