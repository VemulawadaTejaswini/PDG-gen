Line_8 $$ for (int partition = 0; partition < PARTITION_COUNT; partition++) -->Line_9 $$ Operator operator = operatorFactory.createOperator(createDriverContext())[ CD ]
Line_6 $$ int[] rowPartition = new int[ROW_COUNT]-->Line_7 $$ Arrays.fill(rowPartition, -1)[ FD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_23 $$ OperatorAssertion.assertOperatorEqualsIgnoreOrder(operator, input, expected.build(), hashEnabled, Optional.of(3))[ FD ]
Line_8 $$ for (int partition = 0; partition < PARTITION_COUNT; partition++) -->Line_10 $$ MaterializedResult.Builder expected = resultBuilder(TEST_SESSION, BIGINT, BOOLEAN, BOOLEAN, BOOLEAN)[ CD ]
Line_9 $$ Operator operator = operatorFactory.createOperator(createDriverContext())-->Line_23 $$ OperatorAssertion.assertOperatorEqualsIgnoreOrder(operator, input, expected.build(), hashEnabled, Optional.of(3))[ FD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_17 $$ expected.row(i, active && maskValue, active && !maskValue, active)[ CD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_25 $$ assertTrue(IntStream.of(rowPartition).noneMatch( partition -> partition == -1))[ CD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_5 $$ OperatorFactory operatorFactory = new HashPartitionMaskOperatorFactory(0, PARTITION_COUNT, rowPagesBuilder.getTypes(), ImmutableList.of(1, 2), ImmutableList.of(0), rowPagesBuilder.getHashChannel())[ CD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_17 $$ expected.row(i, active && maskValue, active && !maskValue, active)[ FD ]
Line_16 $$ boolean maskValue = i % 2 == 0-->Line_17 $$ expected.row(i, active && maskValue, active && !maskValue, active)[ FD ]
Line_3 $$ RowPagesBuilder rowPagesBuilder = rowPagesBuilder(hashEnabled, Ints.asList(0), BIGINT, BOOLEAN, BOOLEAN)-->Line_5 $$ OperatorFactory operatorFactory = new HashPartitionMaskOperatorFactory(0, PARTITION_COUNT, rowPagesBuilder.getTypes(), ImmutableList.of(1, 2), ImmutableList.of(0), rowPagesBuilder.getHashChannel())[ FD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_6 $$ int[] rowPartition = new int[ROW_COUNT][ CD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_3 $$ RowPagesBuilder rowPagesBuilder = rowPagesBuilder(hashEnabled, Ints.asList(0), BIGINT, BOOLEAN, BOOLEAN)[ CD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_12 $$ int rawHash = (int) BigintOperators.hashCode(i)[ CD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_3 $$ RowPagesBuilder rowPagesBuilder = rowPagesBuilder(hashEnabled, Ints.asList(0), BIGINT, BOOLEAN, BOOLEAN)[ FD ]
Line_18 $$ if (active) -->Line_20 $$ rowPartition[i] = partition[ CD ]
Line_10 $$ MaterializedResult.Builder expected = resultBuilder(TEST_SESSION, BIGINT, BOOLEAN, BOOLEAN, BOOLEAN)-->Line_17 $$ expected.row(i, active && maskValue, active && !maskValue, active)[ FD ]
Line_6 $$ int[] rowPartition = new int[ROW_COUNT]-->Line_25 $$ assertTrue(IntStream.of(rowPartition).noneMatch( partition -> partition == -1))[ FD ]
Line_4 $$ List<Page> input = rowPagesBuilder.addSequencePage(ROW_COUNT, 0, 0, 1).build()-->Line_23 $$ OperatorAssertion.assertOperatorEqualsIgnoreOrder(operator, input, expected.build(), hashEnabled, Optional.of(3))[ FD ]
Line_5 $$ OperatorFactory operatorFactory = new HashPartitionMaskOperatorFactory(0, PARTITION_COUNT, rowPagesBuilder.getTypes(), ImmutableList.of(1, 2), ImmutableList.of(0), rowPagesBuilder.getHashChannel())-->Line_9 $$ Operator operator = operatorFactory.createOperator(createDriverContext())[ FD ]
Line_15 $$ boolean active = (rawHash % PARTITION_COUNT == partition)-->Line_17 $$ expected.row(i, active && maskValue, active && !maskValue, active)[ FD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_12 $$ int rawHash = (int) BigintOperators.hashCode(i)[ FD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_15 $$ boolean active = (rawHash % PARTITION_COUNT == partition)[ CD ]
Line_18 $$ if (active) -->Line_19 $$ assertEquals(rowPartition[i], -1)[ CD ]
Line_12 $$ int rawHash = (int) BigintOperators.hashCode(i)-->Line_13 $$ rawHash = (int) XxHash64.hash(Integer.reverse(rawHash))[ FD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_7 $$ Arrays.fill(rowPartition, -1)[ CD ]
Line_8 $$ for (int partition = 0; partition < PARTITION_COUNT; partition++) -->Line_23 $$ OperatorAssertion.assertOperatorEqualsIgnoreOrder(operator, input, expected.build(), hashEnabled, Optional.of(3))[ CD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_4 $$ List<Page> input = rowPagesBuilder.addSequencePage(ROW_COUNT, 0, 0, 1).build()[ CD ]
Line_8 $$ for (int partition = 0; partition < PARTITION_COUNT; partition++) -->Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) [ CD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_18 $$ if (active) [ CD ]
Line_14 $$ rawHash &= Integer.MAX_VALUE-->Line_13 $$ rawHash = (int) XxHash64.hash(Integer.reverse(rawHash))[ FD ]
Line_3 $$ RowPagesBuilder rowPagesBuilder = rowPagesBuilder(hashEnabled, Ints.asList(0), BIGINT, BOOLEAN, BOOLEAN)-->Line_4 $$ List<Page> input = rowPagesBuilder.addSequencePage(ROW_COUNT, 0, 0, 1).build()[ FD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_13 $$ rawHash = (int) XxHash64.hash(Integer.reverse(rawHash))[ CD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_14 $$ rawHash &= Integer.MAX_VALUE[ CD ]
Line_11 $$ for (int i = 0; i < ROW_COUNT; i++) -->Line_16 $$ boolean maskValue = i % 2 == 0[ CD ]
Line_2 $$ public void testHashPartitionMaskWithMask(boolean hashEnabled) throws Exception -->Line_8 $$ for (int partition = 0; partition < PARTITION_COUNT; partition++) [ CD ]
Line_13 $$ rawHash = (int) XxHash64.hash(Integer.reverse(rawHash))-->Line_14 $$ rawHash &= Integer.MAX_VALUE[ FD ]
Line_8 $$ for (int partition = 0; partition < PARTITION_COUNT; partition++) -->Line_20 $$ rowPartition[i] = partition[ FD ]
Line_12 $$ int rawHash = (int) BigintOperators.hashCode(i)-->Line_14 $$ rawHash &= Integer.MAX_VALUE[ FD ]
Line_10 $$ MaterializedResult.Builder expected = resultBuilder(TEST_SESSION, BIGINT, BOOLEAN, BOOLEAN, BOOLEAN)-->Line_23 $$ OperatorAssertion.assertOperatorEqualsIgnoreOrder(operator, input, expected.build(), hashEnabled, Optional.of(3))[ FD ]
