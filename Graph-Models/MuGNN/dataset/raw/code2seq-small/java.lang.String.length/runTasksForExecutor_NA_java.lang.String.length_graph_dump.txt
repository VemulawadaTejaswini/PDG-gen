Line_92 $$ newClusterState = builder.build()-->Line_196 $$ StringBuilder sb = new StringBuilder("failed to apply updated cluster state in ").append(executionTime).append(":\nversion [").append(newClusterState.version()).append("], uuid [").append(newClusterState.stateUUID()).append("], source [").append(source).append("]\n")[ FD ]
Line_3 $$ final ArrayList<UpdateTask<T>> toExecute = new ArrayList()-->Line_31 $$ toExecute.stream().forEach( task -> task.listener.onNoLongerMaster(task.source))[ FD ]
Line_40 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))-->Line_193 $$ warnAboutSlowTaskIfNeeded(executionTime, source)[ FD ]
Line_34 $$ ClusterStateTaskExecutor.BatchResult<T> batchResult-->Line_49 $$ batchResult = ClusterStateTaskExecutor.BatchResult.<T>builder().failures(toExecute.stream().map( updateTask -> updateTask.task)::<>iterator, e).build(previousClusterState)[ FD ]
Line_8 $$ for (UpdateTask<T> task : pending) -->Line_11 $$ toExecute.add(task)[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_35 $$ long startTimeNS = System.nanoTime()[ CD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_143 $$ logger.warn("failing [[ FD ]
Line_70 $$ if (previousClusterState == newClusterState) -->Line_77 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))[ CD ]
Line_85 $$ Builder builder = ClusterState.builder(newClusterState).incrementVersion()-->Line_92 $$ newClusterState = builder.build()[ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_49 $$ batchResult = ClusterStateTaskExecutor.BatchResult.<T>builder().failures(toExecute.stream().map( updateTask -> updateTask.task)::<>iterator, e).build(previousClusterState)[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)[ CD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_28 $$ ClusterState previousClusterState = clusterState[ CD ]
Line_122 $$ if (nodesDelta.hasChanges() && logger.isInfoEnabled()) -->Line_123 $$ String summary = nodesDelta.shortSummary()[ CD ]
Line_9 $$ if (task.processed.getAndSet(true) == false) -->Line_10 $$ logger.trace("will process [[ CD ]
Line_92 $$ newClusterState = builder.build()-->Line_180 $$ if (newClusterState.nodes().localNodeMaster()) [ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_89 $$ if (previousClusterState.metaData() != newClusterState.metaData()) [ FD ]
Line_121 $$ final DiscoveryNodes.Delta nodesDelta = clusterChangedEvent.nodesDelta()-->Line_165 $$ for (DiscoveryNode node : nodesDelta.removedNodes()) [ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_193 $$ warnAboutSlowTaskIfNeeded(executionTime, source)[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_182 $$ ackListener.onNodeAck(newClusterState.nodes().localNode(), null)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_196 $$ StringBuilder sb = new StringBuilder("failed to apply updated cluster state in ").append(executionTime).append(":\nversion [").append(newClusterState.version()).append("], uuid [").append(newClusterState.stateUUID()).append("], source [").append(source).append("]\n")[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_85 $$ Builder builder = ClusterState.builder(newClusterState).incrementVersion()[ FD ]
Line_138 $$ if (newClusterState.nodes().localNodeMaster()) -->Line_139 $$ logger.debug("publishing cluster state version [[ CD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_86 $$ if (previousClusterState.routingTable() != newClusterState.routingTable()) [ FD ]
Line_3 $$ final ArrayList<UpdateTask<T>> toExecute = new ArrayList()-->Line_52 $$ assert batchResult.executionResults.size() == toExecute.size() : String.format(Locale.ROOT, "expected [%d] task result%s but was [%d]", toExecute.size(), toExecute.size() == 1 ? "" : "s", batchResult.executionResults.size())[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_92 $$ newClusterState = builder.build()[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_138 $$ if (newClusterState.nodes().localNodeMaster()) [ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_199 $$ sb.append(newClusterState.getRoutingNodes().prettyPrint())[ FD ]
Line_83 $$ ArrayList<Discovery.AckListener> ackListeners = new ArrayList()-->Line_100 $$ ackListeners.add(new AckCountDownListener(ackedListener, newClusterState.version(), newClusterState.nodes(), threadPool))[ FD ]
Line_3 $$ final ArrayList<UpdateTask<T>> toExecute = new ArrayList()-->Line_37 $$ List<T> inputs = toExecute.stream().map( tUpdateTask -> tUpdateTask.task).collect(Collectors.toList())[ FD ]
Line_53 $$ boolean assertsEnabled = false-->Line_54 $$ assert (assertsEnabled = true)[ FD ]
Line_40 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))-->Line_196 $$ StringBuilder sb = new StringBuilder("failed to apply updated cluster state in ").append(executionTime).append(":\nversion [").append(newClusterState.version()).append("], uuid [").append(newClusterState.stateUUID()).append("], source [").append(source).append("]\n")[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_143 $$ logger.warn("failing [[ FD ]
Line_121 $$ final DiscoveryNodes.Delta nodesDelta = clusterChangedEvent.nodesDelta()-->Line_123 $$ String summary = nodesDelta.shortSummary()[ FD ]
Line_120 $$ ClusterChangedEvent clusterChangedEvent = new ClusterChangedEvent(source, newClusterState, previousClusterState)-->Line_151 $$ if (clusterChangedEvent.state().blocks().disableStatePersistence() == false && clusterChangedEvent.metaDataChanged()) [ FD ]
Line_40 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))-->Line_48 $$ warnAboutSlowTaskIfNeeded(executionTime, source)[ FD ]
Line_29 $$ if (!previousClusterState.nodes().localNodeMaster() && executor.runOnlyOnMaster()) -->Line_30 $$ logger.debug("failing [[ CD ]
Line_151 $$ if (clusterChangedEvent.state().blocks().disableStatePersistence() == false && clusterChangedEvent.metaDataChanged()) -->Line_153 $$ clusterSettings.applySettings(incomingSettings)[ CD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_143 $$ logger.warn("failing [[ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_115 $$ sb.append(newClusterState.prettyPrint())[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_45 $$ sb.append(previousClusterState.getRoutingNodes().prettyPrint())[ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_188 $$ task.listener.clusterStateProcessed(task.source, previousClusterState, newClusterState)[ FD ]
Line_84 $$ if (newClusterState.nodes().localNodeMaster()) -->Line_86 $$ if (previousClusterState.routingTable() != newClusterState.routingTable()) [ CD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_55 $$ if (assertsEnabled) [ CD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_75 $$ task.listener.clusterStateProcessed(task.source, previousClusterState, newClusterState)[ FD ]
Line_123 $$ String summary = nodesDelta.shortSummary()-->Line_125 $$ logger.info("[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_100 $$ ackListeners.add(new AckCountDownListener(ackedListener, newClusterState.version(), newClusterState.nodes(), threadPool))[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_44 $$ sb.append(previousClusterState.routingTable().prettyPrint())[ FD ]
Line_158 $$ for (ClusterStateListener listener : preAppliedListeners) -->Line_175 $$ listener.clusterChanged(clusterChangedEvent)[ FD ]
Line_34 $$ ClusterStateTaskExecutor.BatchResult<T> batchResult-->Line_38 $$ batchResult = executor.execute(previousClusterState, inputs)[ FD ]
Line_84 $$ if (newClusterState.nodes().localNodeMaster()) -->Line_89 $$ if (previousClusterState.metaData() != newClusterState.metaData()) [ CD ]
Line_92 $$ newClusterState = builder.build()-->Line_197 $$ sb.append(newClusterState.nodes().prettyPrint())[ FD ]
Line_61 $$ final ArrayList<UpdateTask<T>> proccessedListeners = new ArrayList()-->Line_144 $$ proccessedListeners.forEach( task -> task.listener.onFailure(task.source, t))[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_112 $$ newClusterState.status(ClusterState.ClusterStateStatus.BEING_APPLIED)[ FD ]
Line_4 $$ final ArrayList<String> sources = new ArrayList()-->Line_12 $$ sources.add(task.source)[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_188 $$ task.listener.clusterStateProcessed(task.source, previousClusterState, newClusterState)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_192 $$ logger.debug("processing [[ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_60 $$ ClusterState newClusterState = batchResult.resultingState[ CD ]
Line_9 $$ if (task.processed.getAndSet(true) == false) -->Line_14 $$ logger.trace("skipping [[ CD ]
Line_4 $$ final ArrayList<String> sources = new ArrayList()-->Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)[ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_48 $$ warnAboutSlowTaskIfNeeded(executionTime, source)[ FD ]
Line_94 $$ if (task.listener instanceof AckedClusterStateTaskListener) -->Line_95 $$ final AckedClusterStateTaskListener ackedListener = (AckedClusterStateTaskListener) task.listener[ CD ]
Line_3 $$ final ArrayList<UpdateTask<T>> toExecute = new ArrayList()-->Line_19 $$ if (toExecute.isEmpty()) [ FD ]
Line_40 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))-->Line_192 $$ logger.debug("processing [[ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_75 $$ task.listener.clusterStateProcessed(task.source, previousClusterState, newClusterState)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_70 $$ if (previousClusterState == newClusterState) [ FD ]
Line_6 $$ List<UpdateTask> pending = updateTasksPerExecutor.remove(executor)-->Line_7 $$ if (pending != null) [ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_100 $$ ackListeners.add(new AckCountDownListener(ackedListener, newClusterState.version(), newClusterState.nodes(), threadPool))[ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_118 $$ logger.debug("cluster state updated, version [[ FD ]
Line_113 $$ if (logger.isTraceEnabled()) -->Line_116 $$ logger.trace(sb.toString())[ CD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_182 $$ ackListener.onNodeAck(newClusterState.nodes().localNode(), null)[ FD ]
Line_111 $$ final Discovery.AckListener ackListener = new DelegetingAckListener(ackListeners)-->Line_141 $$ discoveryService.publish(clusterChangedEvent, ackListener)[ FD ]
Line_151 $$ if (clusterChangedEvent.state().blocks().disableStatePersistence() == false && clusterChangedEvent.metaDataChanged()) -->Line_152 $$ final Settings incomingSettings = clusterChangedEvent.state().metaData().settings()[ CD ]
Line_121 $$ final DiscoveryNodes.Delta nodesDelta = clusterChangedEvent.nodesDelta()-->Line_128 $$ for (DiscoveryNode node : nodesDelta.addedNodes()) [ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_30 $$ logger.debug("failing [[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_200 $$ logger.warn(sb.toString(), t)[ FD ]
Line_113 $$ if (logger.isTraceEnabled()) -->Line_114 $$ StringBuilder sb = new StringBuilder("cluster state updated, source [").append(source).append("]\n")[ CD ]
Line_56 $$ for (UpdateTask<T> updateTask : toExecute) -->Line_65 $$ proccessedListeners.add(updateTask)[ FD ]
Line_41 $$ if (logger.isTraceEnabled()) -->Line_44 $$ sb.append(previousClusterState.routingTable().prettyPrint())[ CD ]
Line_41 $$ if (logger.isTraceEnabled()) -->Line_43 $$ sb.append(previousClusterState.nodes().prettyPrint())[ CD ]
Line_111 $$ final Discovery.AckListener ackListener = new DelegetingAckListener(ackListeners)-->Line_182 $$ ackListener.onNodeAck(newClusterState.nodes().localNode(), null)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_190 $$ executor.clusterStatePublished(newClusterState)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_149 $$ logger.debug("set local cluster state to version [ FD ]
Line_3 $$ final ArrayList<UpdateTask<T>> toExecute = new ArrayList()-->Line_11 $$ toExecute.add(task)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_90 $$ builder.metaData(MetaData.builder(newClusterState.metaData()).version(newClusterState.metaData().version() + 1))[ FD ]
Line_113 $$ if (logger.isTraceEnabled()) -->Line_117 $$ if (logger.isDebugEnabled()) [ CD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_4 $$ final ArrayList<String> sources = new ArrayList()[ CD ]
Line_92 $$ newClusterState = builder.build()-->Line_138 $$ if (newClusterState.nodes().localNodeMaster()) [ FD ]
Line_29 $$ if (!previousClusterState.nodes().localNodeMaster() && executor.runOnlyOnMaster()) -->Line_32 $$ return[ CD ]
Line_3 $$ final ArrayList<UpdateTask<T>> toExecute = new ArrayList()-->Line_49 $$ batchResult = ClusterStateTaskExecutor.BatchResult.<T>builder().failures(toExecute.stream().map( updateTask -> updateTask.task)::<>iterator, e).build(previousClusterState)[ FD ]
Line_95 $$ final AckedClusterStateTaskListener ackedListener = (AckedClusterStateTaskListener) task.listener-->Line_96 $$ if (ackedListener.ackTimeout() == null || ackedListener.ackTimeout().millis() == 0) [ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_114 $$ StringBuilder sb = new StringBuilder("cluster state updated, source [").append(source).append("]\n")[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_192 $$ logger.debug("processing [[ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_78 $$ logger.debug("processing [[ FD ]
Line_124 $$ if (summary.length() > 0) -->Line_125 $$ logger.info("[ CD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_198 $$ sb.append(newClusterState.routingTable().prettyPrint())[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_198 $$ sb.append(newClusterState.routingTable().prettyPrint())[ FD ]
Line_19 $$ if (toExecute.isEmpty()) -->Line_20 $$ return[ CD ]
Line_85 $$ Builder builder = ClusterState.builder(newClusterState).incrementVersion()-->Line_90 $$ builder.metaData(MetaData.builder(newClusterState.metaData()).version(newClusterState.metaData().version() + 1))[ FD ]
Line_40 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))-->Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_29 $$ if (!previousClusterState.nodes().localNodeMaster() && executor.runOnlyOnMaster()) [ CD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_43 $$ sb.append(previousClusterState.nodes().prettyPrint())[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_184 $$ logger.debug("error while processing ack for master node [[ FD ]
Line_23 $$ if (!lifecycle.started()) -->Line_25 $$ return[ CD ]
Line_120 $$ ClusterChangedEvent clusterChangedEvent = new ClusterChangedEvent(source, newClusterState, previousClusterState)-->Line_160 $$ listener.clusterChanged(clusterChangedEvent)[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_199 $$ sb.append(newClusterState.getRoutingNodes().prettyPrint())[ FD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_24 $$ logger.debug("processing [[ FD ]
Line_120 $$ ClusterChangedEvent clusterChangedEvent = new ClusterChangedEvent(source, newClusterState, previousClusterState)-->Line_141 $$ discoveryService.publish(clusterChangedEvent, ackListener)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_84 $$ if (newClusterState.nodes().localNodeMaster()) [ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_29 $$ if (!previousClusterState.nodes().localNodeMaster() && executor.runOnlyOnMaster()) [ FD ]
Line_113 $$ if (logger.isTraceEnabled()) -->Line_115 $$ sb.append(newClusterState.prettyPrint())[ CD ]
Line_120 $$ ClusterChangedEvent clusterChangedEvent = new ClusterChangedEvent(source, newClusterState, previousClusterState)-->Line_175 $$ listener.clusterChanged(clusterChangedEvent)[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_172 $$ newClusterState.status(ClusterState.ClusterStateStatus.APPLIED)[ FD ]
Line_72 $$ if (task.listener instanceof AckedClusterStateTaskListener) -->Line_73 $$ ((AckedClusterStateTaskListener) task.listener).onAllNodesAcked(null)[ CD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_199 $$ sb.append(newClusterState.getRoutingNodes().prettyPrint())[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_43 $$ sb.append(previousClusterState.nodes().prettyPrint())[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_46 $$ logger.trace(sb.toString(), e)[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_70 $$ if (previousClusterState == newClusterState) [ CD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_188 $$ task.listener.clusterStateProcessed(task.source, previousClusterState, newClusterState)[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_197 $$ sb.append(newClusterState.nodes().prettyPrint())[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_53 $$ boolean assertsEnabled = false[ CD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_27 $$ logger.debug("processing [[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_19 $$ if (toExecute.isEmpty()) [ CD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_38 $$ batchResult = executor.execute(previousClusterState, inputs)[ FD ]
Line_89 $$ if (previousClusterState.metaData() != newClusterState.metaData()) -->Line_90 $$ builder.metaData(MetaData.builder(newClusterState.metaData()).version(newClusterState.metaData().version() + 1))[ CD ]
Line_123 $$ String summary = nodesDelta.shortSummary()-->Line_124 $$ if (summary.length() > 0) [ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_34 $$ ClusterStateTaskExecutor.BatchResult<T> batchResult[ CD ]
Line_117 $$ if (logger.isDebugEnabled()) -->Line_118 $$ logger.debug("cluster state updated, version [[ CD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_38 $$ batchResult = executor.execute(previousClusterState, inputs)[ FD ]
Line_70 $$ if (previousClusterState == newClusterState) -->Line_80 $$ return[ CD ]
Line_92 $$ newClusterState = builder.build()-->Line_118 $$ logger.debug("cluster state updated, version [[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_3 $$ final ArrayList<UpdateTask<T>> toExecute = new ArrayList()[ CD ]
Line_92 $$ newClusterState = builder.build()-->Line_190 $$ executor.clusterStatePublished(newClusterState)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_184 $$ logger.debug("error while processing ack for master node [[ FD ]
Line_9 $$ if (task.processed.getAndSet(true) == false) -->Line_12 $$ sources.add(task.source)[ CD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_196 $$ StringBuilder sb = new StringBuilder("failed to apply updated cluster state in ").append(executionTime).append(":\nversion [").append(newClusterState.version()).append("], uuid [").append(newClusterState.stateUUID()).append("], source [").append(source).append("]\n")[ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_70 $$ if (previousClusterState == newClusterState) [ FD ]
Line_152 $$ final Settings incomingSettings = clusterChangedEvent.state().metaData().settings()-->Line_153 $$ clusterSettings.applySettings(incomingSettings)[ FD ]
Line_121 $$ final DiscoveryNodes.Delta nodesDelta = clusterChangedEvent.nodesDelta()-->Line_122 $$ if (nodesDelta.hasChanges() && logger.isInfoEnabled()) [ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_29 $$ if (!previousClusterState.nodes().localNodeMaster() && executor.runOnlyOnMaster()) [ FD ]
Line_70 $$ if (previousClusterState == newClusterState) -->Line_79 $$ warnAboutSlowTaskIfNeeded(executionTime, source)[ CD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_190 $$ executor.clusterStatePublished(newClusterState)[ FD ]
Line_122 $$ if (nodesDelta.hasChanges() && logger.isInfoEnabled()) -->Line_124 $$ if (summary.length() > 0) [ CD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_192 $$ logger.debug("processing [[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_112 $$ newClusterState.status(ClusterState.ClusterStateStatus.BEING_APPLIED)[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_198 $$ sb.append(newClusterState.routingTable().prettyPrint())[ FD ]
Line_96 $$ if (ackedListener.ackTimeout() == null || ackedListener.ackTimeout().millis() == 0) -->Line_97 $$ ackedListener.onAckTimeout()[ CD ]
Line_85 $$ Builder builder = ClusterState.builder(newClusterState).incrementVersion()-->Line_87 $$ builder.routingTable(RoutingTable.builder(newClusterState.routingTable()).version(newClusterState.routingTable().version() + 1).build())[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_6 $$ List<UpdateTask> pending = updateTasksPerExecutor.remove(executor)[ FD ]
Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")-->Line_116 $$ logger.trace(sb.toString())[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_197 $$ sb.append(newClusterState.nodes().prettyPrint())[ FD ]
Line_86 $$ if (previousClusterState.routingTable() != newClusterState.routingTable()) -->Line_87 $$ builder.routingTable(RoutingTable.builder(newClusterState.routingTable()).version(newClusterState.routingTable().version() + 1).build())[ CD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_27 $$ logger.debug("processing [[ CD ]
Line_41 $$ if (logger.isTraceEnabled()) -->Line_46 $$ logger.trace(sb.toString(), e)[ CD ]
Line_92 $$ newClusterState = builder.build()-->Line_139 $$ logger.debug("publishing cluster state version [[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_89 $$ if (previousClusterState.metaData() != newClusterState.metaData()) [ FD ]
Line_38 $$ batchResult = executor.execute(previousClusterState, inputs)-->Line_49 $$ batchResult = ClusterStateTaskExecutor.BatchResult.<T>builder().failures(toExecute.stream().map( updateTask -> updateTask.task)::<>iterator, e).build(previousClusterState)[ FD ]
Line_37 $$ List<T> inputs = toExecute.stream().map( tUpdateTask -> tUpdateTask.task).collect(Collectors.toList())-->Line_38 $$ batchResult = executor.execute(previousClusterState, inputs)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_180 $$ if (newClusterState.nodes().localNodeMaster()) [ FD ]
Line_61 $$ final ArrayList<UpdateTask<T>> proccessedListeners = new ArrayList()-->Line_65 $$ proccessedListeners.add(updateTask)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_172 $$ newClusterState.status(ClusterState.ClusterStateStatus.APPLIED)[ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_44 $$ sb.append(previousClusterState.routingTable().prettyPrint())[ FD ]
Line_40 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))-->Line_78 $$ logger.debug("processing [[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_87 $$ builder.routingTable(RoutingTable.builder(newClusterState.routingTable()).version(newClusterState.routingTable().version() + 1).build())[ FD ]
Line_95 $$ final AckedClusterStateTaskListener ackedListener = (AckedClusterStateTaskListener) task.listener-->Line_105 $$ ackedListener.onAckTimeout()[ FD ]
Line_64 $$ final ClusterStateTaskExecutor.TaskResult executionResult = batchResult.executionResults.get(updateTask.task)-->Line_65 $$ executionResult.handle(() -> proccessedListeners.add(updateTask),  ex -> [ FD ]
Line_84 $$ if (newClusterState.nodes().localNodeMaster()) -->Line_92 $$ newClusterState = builder.build()[ CD ]
Line_94 $$ if (task.listener instanceof AckedClusterStateTaskListener) -->Line_96 $$ if (ackedListener.ackTimeout() == null || ackedListener.ackTimeout().millis() == 0) [ CD ]
Line_29 $$ if (!previousClusterState.nodes().localNodeMaster() && executor.runOnlyOnMaster()) -->Line_31 $$ toExecute.stream().forEach( task -> task.listener.onNoLongerMaster(task.source))[ CD ]
Line_92 $$ newClusterState = builder.build()-->Line_149 $$ logger.debug("set local cluster state to version [ FD ]
Line_95 $$ final AckedClusterStateTaskListener ackedListener = (AckedClusterStateTaskListener) task.listener-->Line_97 $$ ackedListener.onAckTimeout()[ FD ]
Line_120 $$ ClusterChangedEvent clusterChangedEvent = new ClusterChangedEvent(source, newClusterState, previousClusterState)-->Line_121 $$ final DiscoveryNodes.Delta nodesDelta = clusterChangedEvent.nodesDelta()[ FD ]
Line_92 $$ newClusterState = builder.build()-->Line_115 $$ sb.append(newClusterState.prettyPrint())[ FD ]
Line_28 $$ ClusterState previousClusterState = clusterState-->Line_45 $$ sb.append(previousClusterState.getRoutingNodes().prettyPrint())[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_139 $$ logger.debug("publishing cluster state version [[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_23 $$ if (!lifecycle.started()) [ CD ]
Line_9 $$ if (task.processed.getAndSet(true) == false) -->Line_11 $$ toExecute.add(task)[ CD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_79 $$ warnAboutSlowTaskIfNeeded(executionTime, source)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_118 $$ logger.debug("cluster state updated, version [[ FD ]
Line_84 $$ if (newClusterState.nodes().localNodeMaster()) -->Line_85 $$ Builder builder = ClusterState.builder(newClusterState).incrementVersion()[ CD ]
Line_41 $$ if (logger.isTraceEnabled()) -->Line_42 $$ StringBuilder sb = new StringBuilder("failed to execute cluster state update in ").append(executionTime).append(", state:\nversion [").append(previousClusterState.version()).append("], source [").append(source).append("]\n")[ CD ]
Line_128 $$ for (DiscoveryNode node : nodesDelta.addedNodes()) -->Line_129 $$ if (!nodeRequiresConnection(node)) [ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_86 $$ if (previousClusterState.routingTable() != newClusterState.routingTable()) [ FD ]
Line_102 $$ if (logger.isDebugEnabled()) -->Line_103 $$ logger.debug("Couldn't schedule timeout thread - node might be shutting down", ex)[ CD ]
Line_22 $$ final String source = Strings.collectionToCommaDelimitedString(sources)-->Line_125 $$ logger.info("[ FD ]
Line_23 $$ if (!lifecycle.started()) -->Line_24 $$ logger.debug("processing [[ CD ]
Line_128 $$ for (DiscoveryNode node : nodesDelta.addedNodes()) -->Line_167 $$ transportService.disconnectFromNode(node)[ FD ]
Line_40 $$ TimeValue executionTime = TimeValue.timeValueMillis(Math.max(0, TimeValue.nsecToMSec(System.nanoTime() - startTimeNS)))-->Line_79 $$ warnAboutSlowTaskIfNeeded(executionTime, source)[ FD ]
Line_2 $$ <T> void runTasksForExecutor(ClusterStateTaskExecutor<T> executor) -->Line_61 $$ final ArrayList<UpdateTask<T>> proccessedListeners = new ArrayList()[ CD ]
Line_41 $$ if (logger.isTraceEnabled()) -->Line_45 $$ sb.append(previousClusterState.getRoutingNodes().prettyPrint())[ CD ]
Line_70 $$ if (previousClusterState == newClusterState) -->Line_78 $$ logger.debug("processing [[ CD ]
Line_120 $$ ClusterChangedEvent clusterChangedEvent = new ClusterChangedEvent(source, newClusterState, previousClusterState)-->Line_152 $$ final Settings incomingSettings = clusterChangedEvent.state().metaData().settings()[ FD ]
Line_128 $$ for (DiscoveryNode node : nodesDelta.addedNodes()) -->Line_133 $$ transportService.connectToNode(node)[ FD ]
Line_158 $$ for (ClusterStateListener listener : preAppliedListeners) -->Line_160 $$ listener.clusterChanged(clusterChangedEvent)[ FD ]
Line_60 $$ ClusterState newClusterState = batchResult.resultingState-->Line_115 $$ sb.append(newClusterState.prettyPrint())[ FD ]
