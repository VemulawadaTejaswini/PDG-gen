Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()[ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_73 $$ prevRoutingTable = routingTable[ FD ]
Line_6 $$ MetaData.Builder metaDataBuilder = MetaData.builder()-->Line_10 $$ MetaData metaData = metaDataBuilder.build()[ FD ]
Line_3 $$ AllocationService strategy = createAllocationService(settingsBuilder().put("cluster.routing.allocation.concurrent_recoveries", 10).put(ClusterRebalanceAllocationDecider.CLUSTER_ROUTING_ALLOCATION_ALLOW_REBALANCE_SETTING.getKey(), "always").put("cluster.routing.allocation.cluster_concurrent_rebalance", -1).build())-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_81 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ CD ]
Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_78 $$ int numberOfStartedShards = 0-->Line_97 $$ assertThat(numberOfStartedShards, equalTo(25))[ FD ]
Line_93 $$ int nodeIndex = Integer.parseInt(nodeId.substring("node".length()))-->Line_94 $$ assertThat(nodeIndex, lessThan(25))[ FD ]
Line_50 $$ for (RoutingNode routingNode : routingNodes) -->Line_52 $$ assertThat(routingNode.size(), equalTo(2))[ FD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_82 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_26 $$ DiscoveryNodes.Builder nodesBuilder = DiscoveryNodes.builder()[ CD ]
Line_26 $$ DiscoveryNodes.Builder nodesBuilder = DiscoveryNodes.builder()-->Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ FD ]
Line_50 $$ for (RoutingNode routingNode : routingNodes) -->Line_51 $$ assertThat(routingNode.numberOfShardsWithState(STARTED), equalTo(0))[ FD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_85 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == STARTED) [ CD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_19 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_25 $$ logger.info("Adding " + (numberOfIndices / 2) + " nodes")[ CD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_7 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) [ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_90 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ FD ]
Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_85 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == STARTED) -->Line_87 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == RELOCATING) [ CD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_82 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_77 $$ int numberOfRelocatingShards = 0-->Line_88 $$ numberOfRelocatingShards++[ FD ]
Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_7 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_12 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_37 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_11 $$ RoutingTable.Builder routingTableBuilder = RoutingTable.builder()[ CD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_10 $$ MetaData metaData = metaDataBuilder.build()-->Line_13 $$ routingTableBuilder.addAsNew(metaData.index("test" + i))[ FD ]
Line_6 $$ MetaData.Builder metaDataBuilder = MetaData.builder()-->Line_8 $$ metaDataBuilder.put(IndexMetaData.builder("test" + i).settings(settings(Version.CURRENT)).numberOfShards(1).numberOfReplicas(0))[ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_82 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_83 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ FD ]
Line_12 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_36 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_85 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == STARTED) [ FD ]
Line_85 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == STARTED) -->Line_86 $$ numberOfStartedShards++[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_76 $$ assertThat(prevRoutingTable != routingTable, equalTo(true))[ CD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_48 $$ RoutingNodes routingNodes = clusterState.getRoutingNodes()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_27 $$ List<DiscoveryNode> nodes = new ArrayList()[ CD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_41 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), equalTo(INITIALIZING))[ FD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_45 $$ int nodeIndex = Integer.parseInt(nodeId.substring("node".length()))[ CD ]
Line_12 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) [ FD ]
Line_12 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) [ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_97 $$ assertThat(numberOfStartedShards, equalTo(25))[ CD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_90 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_22 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), equalTo(UNASSIGNED))[ FD ]
Line_12 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_13 $$ routingTableBuilder.addAsNew(metaData.index("test" + i))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_31 $$ RoutingTable prevRoutingTable = routingTable[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ CD ]
Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ CD ]
Line_63 $$ nodesBuilder = DiscoveryNodes.builder(clusterState.nodes())-->Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ FD ]
Line_49 $$ Set<String> encounteredIndices = new HashSet()-->Line_59 $$ encounteredIndices.add(shardRoutingEntry.index())[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_19 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_63 $$ nodesBuilder = DiscoveryNodes.builder(clusterState.nodes())[ CD ]
Line_63 $$ nodesBuilder = DiscoveryNodes.builder(clusterState.nodes())-->Line_65 $$ nodesBuilder.put(newNode("node" + i))[ FD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_90 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ FD ]
Line_11 $$ RoutingTable.Builder routingTableBuilder = RoutingTable.builder()-->Line_13 $$ routingTableBuilder.addAsNew(metaData.index("test" + i))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_10 $$ MetaData metaData = metaDataBuilder.build()[ CD ]
Line_48 $$ RoutingNodes routingNodes = clusterState.getRoutingNodes()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_87 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == RELOCATING) [ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ CD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_85 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == STARTED) [ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_39 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ FD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) [ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ CD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_84 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), anyOf(equalTo(STARTED), equalTo(RELOCATING)))[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_4 $$ final int numberOfIndices = 50-->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_10 $$ MetaData metaData = metaDataBuilder.build()-->Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()[ FD ]
Line_78 $$ int numberOfStartedShards = 0-->Line_86 $$ numberOfStartedShards++[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_83 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ FD ]
Line_11 $$ RoutingTable.Builder routingTableBuilder = RoutingTable.builder()-->Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()[ FD ]
Line_4 $$ final int numberOfIndices = 50-->Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) [ FD ]
Line_45 $$ int nodeIndex = Integer.parseInt(nodeId.substring("node".length()))-->Line_55 $$ assertThat(nodeIndex, lessThan(25))[ FD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) [ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_38 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_18 $$ for (int i = 0; i < numberOfIndices; i++) [ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_90 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_23 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).currentNodeId(), nullValue())[ CD ]
Line_31 $$ RoutingTable prevRoutingTable = routingTable-->Line_73 $$ prevRoutingTable = routingTable[ FD ]
Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_38 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_80 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) -->Line_36 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_73 $$ prevRoutingTable = routingTable[ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_5 $$ logger.info("Building initial routing table with " + numberOfIndices + " indices")[ CD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_81 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ FD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_42 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ CD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_20 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_12 $$ for (int i = 0; i < numberOfIndices; i++) [ CD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_42 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_67 $$ prevRoutingTable = routingTable[ FD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_63 $$ nodesBuilder = DiscoveryNodes.builder(clusterState.nodes())[ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_82 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ FD ]
Line_45 $$ int nodeIndex = Integer.parseInt(nodeId.substring("node".length()))-->Line_46 $$ assertThat(nodeIndex, lessThan(25))[ FD ]
Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ FD ]
Line_7 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_36 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) [ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_71 $$ assertThat(prevRoutingTable != routingTable, equalTo(false))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_96 $$ assertThat(numberOfRelocatingShards, equalTo(25))[ CD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_94 $$ assertThat(nodeIndex, lessThan(25))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_67 $$ prevRoutingTable = routingTable[ CD ]
Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_63 $$ nodesBuilder = DiscoveryNodes.builder(clusterState.nodes())[ FD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_84 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), anyOf(equalTo(STARTED), equalTo(RELOCATING)))[ FD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_21 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ CD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_38 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ FD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_39 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_4 $$ final int numberOfIndices = 50[ CD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_46 $$ assertThat(nodeIndex, lessThan(25))[ CD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ FD ]
Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_23 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).currentNodeId(), nullValue())[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_87 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == RELOCATING) [ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_17 $$ assertThat(routingTable.indicesRouting().size(), equalTo(numberOfIndices))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_72 $$ logger.info("Marking the shard as started")[ CD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_87 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == RELOCATING) [ FD ]
Line_4 $$ final int numberOfIndices = 50-->Line_17 $$ assertThat(routingTable.indicesRouting().size(), equalTo(numberOfIndices))[ FD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_83 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_20 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_36 $$ for (int i = 0; i < numberOfIndices; i++) [ CD ]
Line_26 $$ DiscoveryNodes.Builder nodesBuilder = DiscoveryNodes.builder()-->Line_65 $$ nodesBuilder.put(newNode("node" + i))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_37 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_82 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ FD ]
Line_45 $$ int nodeIndex = Integer.parseInt(nodeId.substring("node".length()))-->Line_94 $$ assertThat(nodeIndex, lessThan(25))[ FD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_81 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_77 $$ int numberOfRelocatingShards = 0[ CD ]
Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) -->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_80 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_63 $$ nodesBuilder = DiscoveryNodes.builder(clusterState.nodes())[ FD ]
Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_80 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_6 $$ MetaData.Builder metaDataBuilder = MetaData.builder()[ CD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_4 $$ final int numberOfIndices = 50-->Line_36 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_12 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_48 $$ RoutingNodes routingNodes = clusterState.getRoutingNodes()[ FD ]
Line_26 $$ DiscoveryNodes.Builder nodesBuilder = DiscoveryNodes.builder()-->Line_63 $$ nodesBuilder = DiscoveryNodes.builder(clusterState.nodes())[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_17 $$ assertThat(routingTable.indicesRouting().size(), equalTo(numberOfIndices))[ CD ]
Line_87 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == RELOCATING) -->Line_88 $$ numberOfRelocatingShards++[ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_41 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), equalTo(INITIALIZING))[ FD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_93 $$ int nodeIndex = Integer.parseInt(nodeId.substring("node".length()))[ CD ]
Line_7 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) [ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_7 $$ for (int i = 0; i < numberOfIndices; i++) [ CD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_84 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), anyOf(equalTo(STARTED), equalTo(RELOCATING)))[ FD ]
Line_3 $$ AllocationService strategy = createAllocationService(settingsBuilder().put("cluster.routing.allocation.concurrent_recoveries", 10).put(ClusterRebalanceAllocationDecider.CLUSTER_ROUTING_ALLOCATION_ALLOW_REBALANCE_SETTING.getKey(), "always").put("cluster.routing.allocation.cluster_concurrent_rebalance", -1).build())-->Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_49 $$ Set<String> encounteredIndices = new HashSet()-->Line_58 $$ assertThat(encounteredIndices, not(hasItem(shardRoutingEntry.index())))[ FD ]
Line_12 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_18 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_81 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ FD ]
Line_34 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_48 $$ RoutingNodes routingNodes = clusterState.getRoutingNodes()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_48 $$ RoutingNodes routingNodes = clusterState.getRoutingNodes()[ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_84 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), anyOf(equalTo(STARTED), equalTo(RELOCATING)))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_85 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == STARTED) [ FD ]
Line_26 $$ DiscoveryNodes.Builder nodesBuilder = DiscoveryNodes.builder()-->Line_29 $$ nodesBuilder.put(newNode("node" + i))[ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_40 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_67 $$ prevRoutingTable = routingTable-->Line_73 $$ prevRoutingTable = routingTable[ FD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_87 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == RELOCATING) [ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_37 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_70 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_67 $$ prevRoutingTable = routingTable[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_73 $$ prevRoutingTable = routingTable[ CD ]
Line_32 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()-->Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ FD ]
Line_31 $$ RoutingTable prevRoutingTable = routingTable-->Line_67 $$ prevRoutingTable = routingTable[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) [ CD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_41 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), equalTo(INITIALIZING))[ CD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_81 $$ assertThat(routingTable.index("test" + i).shard(0).size(), equalTo(1))[ FD ]
Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) -->Line_29 $$ nodesBuilder.put(newNode("node" + i))[ CD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_80 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ CD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_40 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ CD ]
Line_4 $$ final int numberOfIndices = 50-->Line_18 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ CD ]
Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) -->Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) [ FD ]
Line_64 $$ for (int i = (numberOfIndices / 2); i < numberOfIndices; i++) -->Line_65 $$ nodesBuilder.put(newNode("node" + i))[ CD ]
Line_4 $$ final int numberOfIndices = 50-->Line_12 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_77 $$ int numberOfRelocatingShards = 0-->Line_96 $$ assertThat(numberOfRelocatingShards, equalTo(25))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_21 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ FD ]
Line_3 $$ AllocationService strategy = createAllocationService(settingsBuilder().put("cluster.routing.allocation.concurrent_recoveries", 10).put(ClusterRebalanceAllocationDecider.CLUSTER_ROUTING_ALLOCATION_ALLOW_REBALANCE_SETTING.getKey(), "always").put("cluster.routing.allocation.cluster_concurrent_rebalance", -1).build())-->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_35 $$ assertThat(prevRoutingTable != routingTable, equalTo(true))[ CD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_40 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_73 $$ prevRoutingTable = routingTable[ FD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_36 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()[ FD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_83 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ CD ]
Line_36 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_85 $$ if (routingTable.index("test" + i).shard(0).shards().get(0).state() == STARTED) [ FD ]
Line_26 $$ DiscoveryNodes.Builder nodesBuilder = DiscoveryNodes.builder()-->Line_68 $$ clusterState = ClusterState.builder(clusterState).nodes(nodesBuilder).build()[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_42 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ FD ]
Line_15 $$ RoutingTable routingTable = routingTableBuilder.build()-->Line_75 $$ clusterState = ClusterState.builder(clusterState).routingTable(routingTable).build()[ FD ]
Line_74 $$ routingTable = strategy.applyStartedShards(clusterState, routingNodes.shardsWithState(INITIALIZING)).routingTable()-->Line_80 $$ assertThat(routingTable.index("test" + i).shards().size(), equalTo(1))[ FD ]
Line_18 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_22 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), equalTo(UNASSIGNED))[ CD ]
Line_16 $$ ClusterState clusterState = ClusterState.builder(org.elasticsearch.cluster.ClusterName.DEFAULT).metaData(metaData).routingTable(routingTable).build()-->Line_69 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()[ FD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_90 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).primary(), equalTo(true))[ CD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_39 $$ assertThat(routingTable.index("test" + i).shard(0).shards().size(), equalTo(1))[ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_62 $$ logger.info("Adding additional " + (numberOfIndices / 2) + " nodes, nothing should change")[ CD ]
Line_7 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_18 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_33 $$ routingTable = strategy.reroute(clusterState, "reroute").routingTable()-->Line_83 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).unassigned(), equalTo(false))[ FD ]
Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) -->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_78 $$ int numberOfStartedShards = 0[ CD ]
Line_7 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_79 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_7 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_8 $$ metaDataBuilder.put(IndexMetaData.builder("test" + i).settings(settings(Version.CURRENT)).numberOfShards(1).numberOfReplicas(0))[ CD ]
Line_4 $$ final int numberOfIndices = 50-->Line_7 $$ for (int i = 0; i < numberOfIndices; i++) [ FD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_49 $$ Set<String> encounteredIndices = new HashSet()[ CD ]
Line_79 $$ for (int i = 0; i < numberOfIndices; i++) -->Line_84 $$ assertThat(routingTable.index("test" + i).shard(0).shards().get(0).state(), anyOf(equalTo(STARTED), equalTo(RELOCATING)))[ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_28 $$ for (int i = 0; i < (numberOfIndices / 2); i++) [ CD ]
Line_2 $$ public void testMultiIndexEvenDistribution() -->Line_3 $$ AllocationService strategy = createAllocationService(settingsBuilder().put("cluster.routing.allocation.concurrent_recoveries", 10).put(ClusterRebalanceAllocationDecider.CLUSTER_ROUTING_ALLOCATION_ALLOW_REBALANCE_SETTING.getKey(), "always").put("cluster.routing.allocation.cluster_concurrent_rebalance", -1).build())[ CD ]
