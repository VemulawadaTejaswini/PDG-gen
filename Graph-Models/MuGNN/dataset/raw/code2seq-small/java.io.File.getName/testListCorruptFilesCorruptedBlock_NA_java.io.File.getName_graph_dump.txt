Line_6 $$ Configuration conf = new HdfsConfiguration()-->Line_8 $$ conf.setInt(DFSConfigKeys.DFS_BLOCKREPORT_INTERVAL_MSEC_KEY, 3 * 1000)[ FD ]
Line_3 $$ MiniDFSCluster cluster = null-->Line_10 $$ cluster = new MiniDFSCluster.Builder(conf).build()[ FD ]
Line_11 $$ FileSystem fs = cluster.getFileSystem()-->Line_13 $$ util.createFiles(fs, "/srcdat10")[ FD ]
Line_4 $$ Random random = new Random()-->Line_29 $$ random.nextBytes(buffer)[ FD ]
Line_3 $$ MiniDFSCluster cluster = null-->Line_11 $$ FileSystem fs = cluster.getFileSystem()[ FD ]
Line_12 $$ DFSTestUtil util = new DFSTestUtil.Builder().setName("testCorruptFilesCorruptedBlock").setNumFiles(2).setMaxLevels(1).setMaxSize(512).build()-->Line_13 $$ util.createFiles(fs, "/srcdat10")[ FD ]
Line_14 $$ final NameNode namenode = cluster.getNameNode()-->Line_15 $$ Collection<FSNamesystem.CorruptFileBlockInfo> badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)[ FD ]
Line_15 $$ Collection<FSNamesystem.CorruptFileBlockInfo> badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)-->Line_40 $$ badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)[ FD ]
Line_40 $$ badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)-->Line_41 $$ LOG.info("Namenode has bad files. " + badFiles.size())[ FD ]
Line_24 $$ RandomAccessFile file = new RandomAccessFile(metaFile, "rw")-->Line_31 $$ file.close()[ FD ]
Line_10 $$ cluster = new MiniDFSCluster.Builder(conf).build()-->Line_46 $$ cluster.shutdown()[ FD ]
Line_15 $$ Collection<FSNamesystem.CorruptFileBlockInfo> badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)-->Line_16 $$ assertTrue("Namenode has " + badFiles.size() + " corrupt files. Expecting None.", badFiles.size() == 0)[ FD ]
Line_14 $$ final NameNode namenode = cluster.getNameNode()-->Line_40 $$ badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)[ FD ]
Line_6 $$ Configuration conf = new HdfsConfiguration()-->Line_9 $$ conf.setInt(DFSConfigKeys.DFS_CLIENT_RETRY_WINDOW_BASE, 10)[ FD ]
Line_45 $$ if (cluster != null) -->Line_46 $$ cluster.shutdown()[ CD ]
Line_17 $$ String bpid = cluster.getNamesystem().getBlockPoolId()-->Line_19 $$ File data_dir = MiniDFSCluster.getFinalizedDir(storageDir, bpid)[ FD ]
Line_15 $$ Collection<FSNamesystem.CorruptFileBlockInfo> badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)-->Line_42 $$ assertTrue("Namenode has " + badFiles.size() + " bad files. Expecting 1.", badFiles.size() == 1)[ FD ]
Line_10 $$ cluster = new MiniDFSCluster.Builder(conf).build()-->Line_14 $$ final NameNode namenode = cluster.getNameNode()[ FD ]
Line_3 $$ MiniDFSCluster cluster = null-->Line_18 $$ File storageDir = cluster.getInstanceStorageDir(0, 1)[ FD ]
Line_21 $$ List<File> metaFiles = MiniDFSCluster.getAllBlockMetadataFiles(data_dir)-->Line_22 $$ assertTrue("Data directory does not contain any blocks or there was an " + "IO error", metaFiles != null && !metaFiles.isEmpty())[ FD ]
Line_15 $$ Collection<FSNamesystem.CorruptFileBlockInfo> badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)-->Line_41 $$ LOG.info("Namenode has bad files. " + badFiles.size())[ FD ]
Line_10 $$ cluster = new MiniDFSCluster.Builder(conf).build()-->Line_11 $$ FileSystem fs = cluster.getFileSystem()[ FD ]
Line_18 $$ File storageDir = cluster.getInstanceStorageDir(0, 1)-->Line_19 $$ File data_dir = MiniDFSCluster.getFinalizedDir(storageDir, bpid)[ FD ]
Line_10 $$ cluster = new MiniDFSCluster.Builder(conf).build()-->Line_18 $$ File storageDir = cluster.getInstanceStorageDir(0, 1)[ FD ]
Line_28 $$ byte[] buffer = new byte[length]-->Line_30 $$ channel.write(ByteBuffer.wrap(buffer), position)[ FD ]
Line_2 $$ public void testListCorruptFilesCorruptedBlock() throws Exception -->Line_4 $$ Random random = new Random()[ CD ]
Line_25 $$ FileChannel channel = file.getChannel()-->Line_26 $$ long position = channel.size() - 2[ FD ]
Line_12 $$ DFSTestUtil util = new DFSTestUtil.Builder().setName("testCorruptFilesCorruptedBlock").setNumFiles(2).setMaxLevels(1).setMaxSize(512).build()-->Line_34 $$ util.checkFiles(fs, "/srcdat10")[ FD ]
Line_26 $$ long position = channel.size() - 2-->Line_30 $$ channel.write(ByteBuffer.wrap(buffer), position)[ FD ]
Line_2 $$ public void testListCorruptFilesCorruptedBlock() throws Exception -->Line_3 $$ MiniDFSCluster cluster = null[ CD ]
Line_12 $$ DFSTestUtil util = new DFSTestUtil.Builder().setName("testCorruptFilesCorruptedBlock").setNumFiles(2).setMaxLevels(1).setMaxSize(512).build()-->Line_43 $$ util.cleanup(fs, "/srcdat10")[ FD ]
Line_23 $$ File metaFile = metaFiles.get(0)-->Line_32 $$ LOG.info("Deliberately corrupting file " + metaFile.getName() + " at offset " + position + " length " + length)[ FD ]
Line_40 $$ badFiles = namenode.getNamesystem().listCorruptFileBlocks("/", null)-->Line_42 $$ assertTrue("Namenode has " + badFiles.size() + " bad files. Expecting 1.", badFiles.size() == 1)[ FD ]
Line_11 $$ FileSystem fs = cluster.getFileSystem()-->Line_34 $$ util.checkFiles(fs, "/srcdat10")[ FD ]
Line_3 $$ MiniDFSCluster cluster = null-->Line_14 $$ final NameNode namenode = cluster.getNameNode()[ FD ]
Line_10 $$ cluster = new MiniDFSCluster.Builder(conf).build()-->Line_17 $$ String bpid = cluster.getNamesystem().getBlockPoolId()[ FD ]
Line_6 $$ Configuration conf = new HdfsConfiguration()-->Line_7 $$ conf.setInt(DFSConfigKeys.DFS_DATANODE_DIRECTORYSCAN_INTERVAL_KEY, 1)[ FD ]
Line_19 $$ File data_dir = MiniDFSCluster.getFinalizedDir(storageDir, bpid)-->Line_20 $$ assertTrue("data directory does not exist", data_dir.exists())[ FD ]
Line_10 $$ cluster = new MiniDFSCluster.Builder(conf).build()-->Line_45 $$ if (cluster != null) [ FD ]
Line_3 $$ MiniDFSCluster cluster = null-->Line_45 $$ if (cluster != null) [ FD ]
Line_3 $$ MiniDFSCluster cluster = null-->Line_17 $$ String bpid = cluster.getNamesystem().getBlockPoolId()[ FD ]
Line_19 $$ File data_dir = MiniDFSCluster.getFinalizedDir(storageDir, bpid)-->Line_21 $$ List<File> metaFiles = MiniDFSCluster.getAllBlockMetadataFiles(data_dir)[ FD ]
Line_25 $$ FileChannel channel = file.getChannel()-->Line_30 $$ channel.write(ByteBuffer.wrap(buffer), position)[ FD ]
Line_24 $$ RandomAccessFile file = new RandomAccessFile(metaFile, "rw")-->Line_25 $$ FileChannel channel = file.getChannel()[ FD ]
Line_11 $$ FileSystem fs = cluster.getFileSystem()-->Line_43 $$ util.cleanup(fs, "/srcdat10")[ FD ]
Line_3 $$ MiniDFSCluster cluster = null-->Line_46 $$ cluster.shutdown()[ FD ]
Line_28 $$ byte[] buffer = new byte[length]-->Line_29 $$ random.nextBytes(buffer)[ FD ]
Line_21 $$ List<File> metaFiles = MiniDFSCluster.getAllBlockMetadataFiles(data_dir)-->Line_23 $$ File metaFile = metaFiles.get(0)[ FD ]
