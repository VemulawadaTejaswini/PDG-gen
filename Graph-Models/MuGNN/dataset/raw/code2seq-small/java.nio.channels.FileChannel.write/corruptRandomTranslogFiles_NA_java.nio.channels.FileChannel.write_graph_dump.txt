Line_6 $$ ShardIterator shardIterator = RandomPicks.randomFrom(getRandom(), iterators)-->Line_7 $$ ShardRouting shardRouting = shardIterator.nextOrNull()[ FD ]
Line_35 $$ fileToCorrupt = RandomPicks.randomFrom(getRandom(), files)-->Line_54 $$ assertThat("no file corrupted", fileToCorrupt, notNullValue())[ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_12 $$ NodesStatsResponse nodeStatses = client().admin().cluster().prepareNodesStats(nodeId).setFs(true).get()[ CD ]
Line_7 $$ ShardRouting shardRouting = shardIterator.nextOrNull()-->Line_10 $$ assertTrue(shardRouting.assignedToNode())[ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_11 $$ String nodeId = shardRouting.currentNodeId()[ CD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_7 $$ ShardRouting shardRouting = shardIterator.nextOrNull()[ CD ]
Line_40 $$ ByteBuffer bb = ByteBuffer.wrap(new byte[1])-->Line_49 $$ raf.write(bb)[ FD ]
Line_16 $$ String path = fsPath.getPath()-->Line_18 $$ Path file = PathUtils.get(path).resolve(relativeDataLocationPath)[ FD ]
Line_5 $$ List<ShardIterator> iterators = iterableAsArrayList(shardIterators)-->Line_6 $$ ShardIterator shardIterator = RandomPicks.randomFrom(getRandom(), iterators)[ FD ]
Line_32 $$ if (!files.isEmpty()) -->Line_34 $$ for (int i = 0; i < corruptions; i++) [ CD ]
Line_17 $$ final String relativeDataLocationPath = "indices/test/" + Integer.toString(shardRouting.getId()) + "/translog"-->Line_18 $$ Path file = PathUtils.get(path).resolve(relativeDataLocationPath)[ FD ]
Line_22 $$ for (Path item : stream) -->Line_25 $$ files.add(item)[ FD ]
Line_36 $$ try (FileChannel raf = FileChannel.open(fileToCorrupt, StandardOpenOption.READ, StandardOpenOption.WRITE)) -->Line_39 $$ long filePointer = raf.position()[ FD ]
Line_7 $$ ShardRouting shardRouting = shardIterator.nextOrNull()-->Line_9 $$ assertTrue(shardRouting.primary())[ FD ]
Line_18 $$ Path file = PathUtils.get(path).resolve(relativeDataLocationPath)-->Line_19 $$ if (Files.exists(file)) [ FD ]
Line_40 $$ ByteBuffer bb = ByteBuffer.wrap(new byte[1])-->Line_42 $$ bb.flip()[ FD ]
Line_45 $$ byte newValue = (byte) (oldValue + 1)-->Line_46 $$ bb.put(0, newValue)[ FD ]
Line_7 $$ ShardRouting shardRouting = shardIterator.nextOrNull()-->Line_8 $$ assertNotNull(shardRouting)[ FD ]
Line_33 $$ int corruptions = randomIntBetween(5, 20)-->Line_34 $$ for (int i = 0; i < corruptions; i++) [ FD ]
Line_34 $$ for (int i = 0; i < corruptions; i++) -->Line_35 $$ fileToCorrupt = RandomPicks.randomFrom(getRandom(), files)[ CD ]
Line_32 $$ if (!files.isEmpty()) -->Line_33 $$ int corruptions = randomIntBetween(5, 20)[ CD ]
Line_12 $$ NodesStatsResponse nodeStatses = client().admin().cluster().prepareNodesStats(nodeId).setFs(true).get()-->Line_15 $$ for (FsInfo.Path fsPath : nodeStatses.getNodes()[0].getFs()) [ FD ]
Line_3 $$ ClusterState state = client().admin().cluster().prepareState().get().getState()-->Line_4 $$ GroupShardsIterator shardIterators = state.getRoutingNodes().getRoutingTable().activePrimaryShardsGrouped(new String[] [ FD ]
Line_24 $$ if (Files.isRegularFile(item) && item.getFileName().toString().startsWith("translog-")) -->Line_25 $$ files.add(item)[ CD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_6 $$ ShardIterator shardIterator = RandomPicks.randomFrom(getRandom(), iterators)[ CD ]
Line_35 $$ fileToCorrupt = RandomPicks.randomFrom(getRandom(), files)-->Line_36 $$ try (FileChannel raf = FileChannel.open(fileToCorrupt, StandardOpenOption.READ, StandardOpenOption.WRITE)) [ FD ]
Line_15 $$ for (FsInfo.Path fsPath : nodeStatses.getNodes()[0].getFs()) -->Line_16 $$ String path = fsPath.getPath()[ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_54 $$ assertThat("no file corrupted", fileToCorrupt, notNullValue())[ CD ]
Line_40 $$ ByteBuffer bb = ByteBuffer.wrap(new byte[1])-->Line_41 $$ raf.read(bb)[ FD ]
Line_11 $$ String nodeId = shardRouting.currentNodeId()-->Line_12 $$ NodesStatsResponse nodeStatses = client().admin().cluster().prepareNodesStats(nodeId).setFs(true).get()[ FD ]
Line_40 $$ ByteBuffer bb = ByteBuffer.wrap(new byte[1])-->Line_46 $$ bb.put(0, newValue)[ FD ]
Line_31 $$ Path fileToCorrupt = null-->Line_54 $$ assertThat("no file corrupted", fileToCorrupt, notNullValue())[ FD ]
Line_4 $$ GroupShardsIterator shardIterators = state.getRoutingNodes().getRoutingTable().activePrimaryShardsGrouped(new String[] -->Line_5 $$ List<ShardIterator> iterators = iterableAsArrayList(shardIterators)[ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_32 $$ if (!files.isEmpty()) [ CD ]
Line_7 $$ ShardRouting shardRouting = shardIterator.nextOrNull()-->Line_11 $$ String nodeId = shardRouting.currentNodeId()[ FD ]
Line_22 $$ for (Path item : stream) -->Line_24 $$ if (Files.isRegularFile(item) && item.getFileName().toString().startsWith("translog-")) [ FD ]
Line_36 $$ try (FileChannel raf = FileChannel.open(fileToCorrupt, StandardOpenOption.READ, StandardOpenOption.WRITE)) -->Line_41 $$ raf.read(bb)[ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_10 $$ assertTrue(shardRouting.assignedToNode())[ CD ]
Line_18 $$ Path file = PathUtils.get(path).resolve(relativeDataLocationPath)-->Line_21 $$ try (DirectoryStream<Path> stream = Files.newDirectoryStream(file)) [ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_9 $$ assertTrue(shardRouting.primary())[ CD ]
Line_36 $$ try (FileChannel raf = FileChannel.open(fileToCorrupt, StandardOpenOption.READ, StandardOpenOption.WRITE)) -->Line_49 $$ raf.write(bb)[ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_3 $$ ClusterState state = client().admin().cluster().prepareState().get().getState()[ CD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_4 $$ GroupShardsIterator shardIterators = state.getRoutingNodes().getRoutingTable().activePrimaryShardsGrouped(new String[] [ CD ]
Line_7 $$ ShardRouting shardRouting = shardIterator.nextOrNull()-->Line_17 $$ final String relativeDataLocationPath = "indices/test/" + Integer.toString(shardRouting.getId()) + "/translog"[ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_31 $$ Path fileToCorrupt = null[ CD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_8 $$ assertNotNull(shardRouting)[ CD ]
Line_31 $$ Path fileToCorrupt = null-->Line_36 $$ try (FileChannel raf = FileChannel.open(fileToCorrupt, StandardOpenOption.READ, StandardOpenOption.WRITE)) [ FD ]
Line_2 $$ private void corruptRandomTranslogFiles() throws IOException -->Line_5 $$ List<ShardIterator> iterators = iterableAsArrayList(shardIterators)[ CD ]
Line_31 $$ Path fileToCorrupt = null-->Line_35 $$ fileToCorrupt = RandomPicks.randomFrom(getRandom(), files)[ FD ]
