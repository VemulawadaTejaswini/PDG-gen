Line_74 $$ while (true) -->Line_86 $$ long version = idVersion.version[ CD ]
Line_33 $$ final Map<String, IDAndVersion> truth = new HashMap()-->Line_91 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_39 $$ version += TestUtil.nextInt(random, 1, 10)-->Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL[ FD ]
Line_33 $$ final Map<String, IDAndVersion> truth = new HashMap()-->Line_98 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_21 $$ if (TEST_NIGHTLY) -->Line_22 $$ numIDs = scaledRandomIntBetween(300, 1000)[ CD ]
Line_83 $$ String id = idVersion.id-->Line_137 $$ long actualVersion = client().prepareGet("test", "type", id).execute().actionGet().getVersion()[ FD ]
Line_11 $$ String idPrefix-->Line_15 $$ idPrefix = TestUtil.randomSimpleString(random)[ FD ]
Line_8 $$ Random random = getRandom()-->Line_15 $$ idPrefix = TestUtil.randomSimpleString(random)[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_3 $$ createIndex("test")[ CD ]
Line_20 $$ int numIDs-->Line_26 $$ while (idsSet.size() < numIDs) [ FD ]
Line_86 $$ long version = idVersion.version-->Line_98 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_66 $$ final long startTime = System.nanoTime()-->Line_85 $$ idVersion.indexStartTime = System.nanoTime() - startTime[ FD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) [ FD ]
Line_22 $$ numIDs = scaledRandomIntBetween(300, 1000)-->Line_44 $$ idVersions[i].id = ids[random.nextInt(numIDs)][ FD ]
Line_108 $$ if (threadRandom.nextInt(100) == 7) -->Line_114 $$ System.out.println(threadID + ": TEST: flush done at " + (System.nanoTime() - startTime))[ CD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_38 $$ if (useMonotonicVersion) [ CD ]
Line_82 $$ IDAndVersion idVersion = idVersions[index]-->Line_87 $$ if (idVersion.delete) [ FD ]
Line_143 $$ if (failed) -->Line_144 $$ System.out.println("All versions:")[ CD ]
Line_12 $$ if (randomBoolean()) -->Line_16 $$ if (VERBOSE) [ CD ]
Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) -->Line_55 $$ idVersions[index] = idVersions[i][ CD ]
Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL-->Line_45 $$ idVersions[i].version = version[ FD ]
Line_8 $$ Random random = getRandom()-->Line_46 $$ idVersions[i].delete = random.nextInt(5) == 2[ FD ]
Line_20 $$ int numIDs-->Line_24 $$ numIDs = scaledRandomIntBetween(50, 100)[ FD ]
Line_103 $$ if (threadRandom.nextInt(100) == 7) -->Line_105 $$ refresh()[ CD ]
Line_10 $$ Set<String> idsSet = new HashSet()-->Line_27 $$ idsSet.add(idPrefix + idSource.next())[ FD ]
Line_33 $$ final Map<String, IDAndVersion> truth = new HashMap()-->Line_49 $$ truth.put(idVersions[i].id, idVersions[i])[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_34 $$ if (VERBOSE) [ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_12 $$ if (randomBoolean()) [ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_4 $$ ensureGreen()[ CD ]
Line_22 $$ numIDs = scaledRandomIntBetween(300, 1000)-->Line_26 $$ while (idsSet.size() < numIDs) [ FD ]
Line_5 $$ HashMap<String, Object> newSettings = new HashMap()-->Line_6 $$ newSettings.put("index.gc_deletes", "1000000h")[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_10 $$ Set<String> idsSet = new HashSet()[ CD ]
Line_10 $$ Set<String> idsSet = new HashSet()-->Line_29 $$ String[] ids = idsSet.toArray(new String[numIDs])[ FD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_44 $$ idVersions[i].id = ids[random.nextInt(numIDs)][ CD ]
Line_103 $$ if (threadRandom.nextInt(100) == 7) -->Line_104 $$ System.out.println(threadID + ": TEST: now refresh at " + (System.nanoTime() - startTime))[ CD ]
Line_63 $$ final AtomicInteger upto = new AtomicInteger()-->Line_75 $$ int index = upto.getAndIncrement()[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_21 $$ if (TEST_NIGHTLY) [ CD ]
Line_48 $$ if (curVersion == null || idVersions[i].version > curVersion.version) -->Line_49 $$ truth.put(idVersions[i].id, idVersions[i])[ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_63 $$ final AtomicInteger upto = new AtomicInteger()[ CD ]
Line_31 $$ long version = 0-->Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL[ FD ]
Line_83 $$ String id = idVersion.id-->Line_89 $$ idVersion.response = client().prepareDelete("test", "type", id).setVersion(version).setVersionType(VersionType.EXTERNAL).execute().actionGet()[ FD ]
Line_8 $$ Random random = getRandom()-->Line_39 $$ version += TestUtil.nextInt(random, 1, 10)[ FD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_47 $$ IDAndVersion curVersion = truth.get(idVersions[i].id)[ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_9 $$ IDSource idSource = getRandomIDs()[ CD ]
Line_83 $$ String id = idVersion.id-->Line_96 $$ idVersion.response = client().prepareIndex("test", "type", id).setSource("foo", "bar").setVersion(version).setVersionType(VersionType.EXTERNAL).get()[ FD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_145 $$ for (int i = 0; i < idVersions.length; i++) [ FD ]
Line_74 $$ while (true) -->Line_79 $$ if (VERBOSE && index % 100 == 0) [ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_58 $$ if (VERBOSE) [ CD ]
Line_75 $$ int index = upto.getAndIncrement()-->Line_76 $$ if (index >= idVersions.length) [ FD ]
Line_86 $$ long version = idVersion.version-->Line_91 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_29 $$ String[] ids = idsSet.toArray(new String[numIDs])[ CD ]
Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) -->Line_54 $$ IDAndVersion x = idVersions[index][ CD ]
Line_74 $$ while (true) -->Line_85 $$ idVersion.indexStartTime = System.nanoTime() - startTime[ CD ]
Line_12 $$ if (randomBoolean()) -->Line_13 $$ idPrefix = ""[ CD ]
Line_38 $$ if (useMonotonicVersion) -->Line_39 $$ version += TestUtil.nextInt(random, 1, 10)[ CD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_46 $$ idVersions[i].delete = random.nextInt(5) == 2[ CD ]
Line_8 $$ Random random = getRandom()-->Line_53 $$ int index = random.nextInt(i + 1)[ FD ]
Line_103 $$ if (threadRandom.nextInt(100) == 7) -->Line_106 $$ System.out.println(threadID + ": TEST: refresh done at " + (System.nanoTime() - startTime))[ CD ]
Line_39 $$ version += TestUtil.nextInt(random, 1, 10)-->Line_89 $$ idVersion.response = client().prepareDelete("test", "type", id).setVersion(version).setVersionType(VersionType.EXTERNAL).execute().actionGet()[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_64 $$ final CountDownLatch startingGun = new CountDownLatch(1)[ CD ]
Line_8 $$ Random random = getRandom()-->Line_32 $$ final IDAndVersion[] idVersions = new IDAndVersion[TestUtil.nextInt(random, numIDs / 2, numIDs * (TEST_NIGHTLY ? 8 : 2))][ FD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_43 $$ idVersions[i] = new IDAndVersion()[ CD ]
Line_16 $$ if (VERBOSE) -->Line_17 $$ System.out.println("TEST: use id prefix: " + idPrefix)[ CD ]
Line_22 $$ numIDs = scaledRandomIntBetween(300, 1000)-->Line_24 $$ numIDs = scaledRandomIntBetween(50, 100)[ FD ]
Line_31 $$ long version = 0-->Line_98 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_143 $$ if (failed) -->Line_148 $$ fail("wrong versions for some IDs")[ CD ]
Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) -->Line_145 $$ for (int i = 0; i < idVersions.length; i++) [ FD ]
Line_74 $$ while (true) -->Line_82 $$ IDAndVersion idVersion = idVersions[index][ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_8 $$ Random random = getRandom()[ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_65 $$ Thread[] threads = new Thread[TestUtil.nextInt(random, 1, TEST_NIGHTLY ? 20 : 5)][ CD ]
Line_74 $$ while (true) -->Line_103 $$ if (threadRandom.nextInt(100) == 7) [ CD ]
Line_67 $$ for (int i = 0; i < threads.length; i++) -->Line_145 $$ for (int i = 0; i < idVersions.length; i++) [ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_5 $$ HashMap<String, Object> newSettings = new HashMap()[ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_32 $$ final IDAndVersion[] idVersions = new IDAndVersion[TestUtil.nextInt(random, numIDs / 2, numIDs * (TEST_NIGHTLY ? 8 : 2))][ CD ]
Line_72 $$ final Random threadRandom = getRandom()-->Line_103 $$ if (threadRandom.nextInt(100) == 7) [ FD ]
Line_64 $$ final CountDownLatch startingGun = new CountDownLatch(1)-->Line_73 $$ startingGun.await()[ FD ]
Line_143 $$ if (failed) -->Line_145 $$ for (int i = 0; i < idVersions.length; i++) [ CD ]
Line_31 $$ long version = 0-->Line_96 $$ idVersion.response = client().prepareIndex("test", "type", id).setSource("foo", "bar").setVersion(version).setVersionType(VersionType.EXTERNAL).get()[ FD ]
Line_83 $$ String id = idVersion.id-->Line_98 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_48 $$ if (curVersion == null || idVersions[i].version > curVersion.version) [ CD ]
Line_5 $$ HashMap<String, Object> newSettings = new HashMap()-->Line_7 $$ assertAcked(client().admin().indices().prepareUpdateSettings("test").setSettings(newSettings).execute().actionGet())[ FD ]
Line_12 $$ if (randomBoolean()) -->Line_15 $$ idPrefix = TestUtil.randomSimpleString(random)[ CD ]
Line_20 $$ int numIDs-->Line_22 $$ numIDs = scaledRandomIntBetween(300, 1000)[ FD ]
Line_31 $$ long version = 0-->Line_45 $$ idVersions[i].version = version[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_67 $$ for (int i = 0; i < threads.length; i++) [ CD ]
Line_74 $$ while (true) -->Line_75 $$ int index = upto.getAndIncrement()[ CD ]
Line_83 $$ String id = idVersion.id-->Line_91 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_79 $$ if (VERBOSE && index % 100 == 0) -->Line_80 $$ System.out.println(Thread.currentThread().getName() + ": index=" + index)[ CD ]
Line_74 $$ while (true) -->Line_76 $$ if (index >= idVersions.length) [ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_124 $$ startingGun.countDown()[ CD ]
Line_8 $$ Random random = getRandom()-->Line_44 $$ idVersions[i].id = ids[random.nextInt(numIDs)][ FD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_67 $$ for (int i = 0; i < threads.length; i++) [ FD ]
Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) -->Line_56 $$ idVersions[i] = x[ CD ]
Line_59 $$ for (IDAndVersion idVersion : idVersions) -->Line_87 $$ if (idVersion.delete) [ FD ]
Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL-->Line_98 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_39 $$ version += TestUtil.nextInt(random, 1, 10)-->Line_45 $$ idVersions[i].version = version[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_37 $$ for (int i = 0; i < idVersions.length; i++) [ CD ]
Line_8 $$ Random random = getRandom()-->Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL[ FD ]
Line_8 $$ Random random = getRandom()-->Line_65 $$ Thread[] threads = new Thread[TestUtil.nextInt(random, 1, TEST_NIGHTLY ? 20 : 5)][ FD ]
Line_24 $$ numIDs = scaledRandomIntBetween(50, 100)-->Line_26 $$ while (idsSet.size() < numIDs) [ FD ]
Line_24 $$ numIDs = scaledRandomIntBetween(50, 100)-->Line_44 $$ idVersions[i].id = ids[random.nextInt(numIDs)][ FD ]
Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL-->Line_96 $$ idVersion.response = client().prepareIndex("test", "type", id).setSource("foo", "bar").setVersion(version).setVersionType(VersionType.EXTERNAL).get()[ FD ]
Line_38 $$ if (useMonotonicVersion) -->Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL[ CD ]
Line_67 $$ for (int i = 0; i < threads.length; i++) -->Line_122 $$ threads[i].start()[ CD ]
Line_72 $$ final Random threadRandom = getRandom()-->Line_108 $$ if (threadRandom.nextInt(100) == 7) [ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_6 $$ newSettings.put("index.gc_deletes", "1000000h")[ CD ]
Line_37 $$ for (int i = 0; i < idVersions.length; i++) -->Line_45 $$ idVersions[i].version = version[ CD ]
Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) -->Line_67 $$ for (int i = 0; i < threads.length; i++) [ FD ]
Line_39 $$ version += TestUtil.nextInt(random, 1, 10)-->Line_91 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_74 $$ while (true) -->Line_102 $$ idVersion.indexFinishTime = System.nanoTime() - startTime[ CD ]
Line_74 $$ while (true) -->Line_108 $$ if (threadRandom.nextInt(100) == 7) [ CD ]
Line_26 $$ while (idsSet.size() < numIDs) -->Line_27 $$ idsSet.add(idPrefix + idSource.next())[ CD ]
Line_13 $$ idPrefix = ""-->Line_15 $$ idPrefix = TestUtil.randomSimpleString(random)[ FD ]
Line_74 $$ while (true) -->Line_87 $$ if (idVersion.delete) [ CD ]
Line_108 $$ if (threadRandom.nextInt(100) == 7) -->Line_109 $$ System.out.println(threadID + ": TEST: now flush at " + (System.nanoTime() - startTime))[ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_33 $$ final Map<String, IDAndVersion> truth = new HashMap()[ CD ]
Line_66 $$ final long startTime = System.nanoTime()-->Line_102 $$ idVersion.indexFinishTime = System.nanoTime() - startTime[ FD ]
Line_138 $$ if (actualVersion != expected) -->Line_139 $$ System.out.println("FAILED: idVersion=" + idVersion + " actualVersion=" + actualVersion)[ CD ]
Line_33 $$ final Map<String, IDAndVersion> truth = new HashMap()-->Line_131 $$ IDAndVersion idVersion = truth.get(id)[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) [ CD ]
Line_52 $$ for (int i = idVersions.length - 1; i > 0; i--) -->Line_53 $$ int index = random.nextInt(i + 1)[ CD ]
Line_67 $$ for (int i = 0; i < threads.length; i++) -->Line_69 $$ threads[i] = new Thread() [ CD ]
Line_74 $$ while (true) -->Line_83 $$ String id = idVersion.id[ CD ]
Line_64 $$ final CountDownLatch startingGun = new CountDownLatch(1)-->Line_124 $$ startingGun.countDown()[ FD ]
Line_31 $$ long version = 0-->Line_91 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_11 $$ String idPrefix[ CD ]
Line_10 $$ Set<String> idsSet = new HashSet()-->Line_26 $$ while (idsSet.size() < numIDs) [ FD ]
Line_21 $$ if (TEST_NIGHTLY) -->Line_24 $$ numIDs = scaledRandomIntBetween(50, 100)[ CD ]
Line_132 $$ if (idVersion != null && idVersion.delete == false) -->Line_135 $$ expected = -1[ CD ]
Line_145 $$ for (int i = 0; i < idVersions.length; i++) -->Line_146 $$ System.out.println("i=" + i + " " + idVersions[i])[ CD ]
Line_39 $$ version += TestUtil.nextInt(random, 1, 10)-->Line_98 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL-->Line_89 $$ idVersion.response = client().prepareDelete("test", "type", id).setVersion(version).setVersionType(VersionType.EXTERNAL).execute().actionGet()[ FD ]
Line_86 $$ long version = idVersion.version-->Line_89 $$ idVersion.response = client().prepareDelete("test", "type", id).setVersion(version).setVersionType(VersionType.EXTERNAL).execute().actionGet()[ FD ]
Line_83 $$ String id = idVersion.id-->Line_131 $$ IDAndVersion idVersion = truth.get(id)[ FD ]
Line_33 $$ final Map<String, IDAndVersion> truth = new HashMap()-->Line_47 $$ IDAndVersion curVersion = truth.get(idVersions[i].id)[ FD ]
Line_54 $$ IDAndVersion x = idVersions[index]-->Line_56 $$ idVersions[i] = x[ FD ]
Line_86 $$ long version = idVersion.version-->Line_96 $$ idVersion.response = client().prepareIndex("test", "type", id).setSource("foo", "bar").setVersion(version).setVersionType(VersionType.EXTERNAL).get()[ FD ]
Line_53 $$ int index = random.nextInt(i + 1)-->Line_76 $$ if (index >= idVersions.length) [ FD ]
Line_34 $$ if (VERBOSE) -->Line_35 $$ System.out.println("TEST: use " + numIDs + " ids; " + idVersions.length + " operations")[ CD ]
Line_20 $$ int numIDs-->Line_44 $$ idVersions[i].id = ids[random.nextInt(numIDs)][ FD ]
Line_67 $$ for (int i = 0; i < threads.length; i++) -->Line_68 $$ final int threadID = i[ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_7 $$ assertAcked(client().admin().indices().prepareUpdateSettings("test").setSettings(newSettings).execute().actionGet())[ CD ]
Line_9 $$ IDSource idSource = getRandomIDs()-->Line_27 $$ idsSet.add(idPrefix + idSource.next())[ FD ]
Line_11 $$ String idPrefix-->Line_13 $$ idPrefix = ""[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_30 $$ boolean useMonotonicVersion = randomBoolean()[ CD ]
Line_41 $$ version = random.nextLong() & 0x3fffffffffffffffL-->Line_91 $$ assertThat(version, lessThanOrEqualTo(truth.get(id).version))[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_66 $$ final long startTime = System.nanoTime()[ CD ]
Line_39 $$ version += TestUtil.nextInt(random, 1, 10)-->Line_96 $$ idVersion.response = client().prepareIndex("test", "type", id).setSource("foo", "bar").setVersion(version).setVersionType(VersionType.EXTERNAL).get()[ FD ]
Line_33 $$ final Map<String, IDAndVersion> truth = new HashMap()-->Line_60 $$ System.out.println("id=" + idVersion.id + " version=" + idVersion.version + " delete?=" + idVersion.delete + " truth?=" + (truth.get(idVersion.id) == idVersion))[ FD ]
Line_31 $$ long version = 0-->Line_39 $$ version += TestUtil.nextInt(random, 1, 10)[ FD ]
Line_31 $$ long version = 0-->Line_89 $$ idVersion.response = client().prepareDelete("test", "type", id).setVersion(version).setVersionType(VersionType.EXTERNAL).execute().actionGet()[ FD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_143 $$ if (failed) [ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_26 $$ while (idsSet.size() < numIDs) [ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_31 $$ long version = 0[ CD ]
Line_2 $$ public void testRandomIDsAndVersions() throws Exception -->Line_20 $$ int numIDs[ CD ]
