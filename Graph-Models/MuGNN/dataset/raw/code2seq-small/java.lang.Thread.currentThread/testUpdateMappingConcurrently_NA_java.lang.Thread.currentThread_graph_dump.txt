Line_23 $$ for (int i = 0; i < 100; i++) -->Line_32 $$ PutMappingResponse response = client1.admin().indices().preparePutMapping(indexName).setType(typeName).setSource(JsonXContent.contentBuilder().startObject().startObject(typeName).startObject("properties").startObject(fieldName).field("type", "string").endObject().endObject().endObject().endObject()).get()[ CD ]
Line_32 $$ PutMappingResponse response = client1.admin().indices().preparePutMapping(indexName).setType(typeName).setSource(JsonXContent.contentBuilder().startObject().startObject(typeName).startObject("properties").startObject(fieldName).field("type", "string").endObject().endObject().endObject().endObject()).get()-->Line_33 $$ assertThat(response.isAcknowledged(), equalTo(true))[ FD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_35 $$ ImmutableOpenMap<String, MappingMetaData> mappings = getMappingResponse.getMappings().get(indexName)[ CD ]
Line_24 $$ if (stop.get()) -->Line_25 $$ return[ CD ]
Line_35 $$ ImmutableOpenMap<String, MappingMetaData> mappings = getMappingResponse.getMappings().get(indexName)-->Line_37 $$ assertThat(((Map<String, Object>) mappings.get(typeName).getSourceAsMap().get("properties")).keySet(), Matchers.hasItem(fieldName))[ FD ]
Line_29 $$ String indexName = i % 2 == 0 ? "test2" : "test1"-->Line_34 $$ GetMappingsResponse getMappingResponse = client2.admin().indices().prepareGetMappings(indexName).get()[ FD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_33 $$ assertThat(response.isAcknowledged(), equalTo(true))[ CD ]
Line_34 $$ GetMappingsResponse getMappingResponse = client2.admin().indices().prepareGetMappings(indexName).get()-->Line_35 $$ ImmutableOpenMap<String, MappingMetaData> mappings = getMappingResponse.getMappings().get(indexName)[ FD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_36 $$ assertThat(mappings.containsKey(typeName), equalTo(true))[ CD ]
Line_29 $$ String indexName = i % 2 == 0 ? "test2" : "test1"-->Line_35 $$ ImmutableOpenMap<String, MappingMetaData> mappings = getMappingResponse.getMappings().get(indexName)[ FD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_8 $$ final AtomicBoolean stop = new AtomicBoolean(false)[ CD ]
Line_30 $$ String typeName = "type" + (i % 10)-->Line_32 $$ PutMappingResponse response = client1.admin().indices().preparePutMapping(indexName).setType(typeName).setSource(JsonXContent.contentBuilder().startObject().startObject(typeName).startObject("properties").startObject(fieldName).field("type", "string").endObject().endObject().endObject().endObject()).get()[ FD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_27 $$ Client client1 = clientArray.get(i % clientArray.size())[ CD ]
Line_11 $$ final ArrayList<Client> clientArray = new ArrayList()-->Line_27 $$ Client client1 = clientArray.get(i % clientArray.size())[ FD ]
Line_31 $$ String fieldName = Thread.currentThread().getName() + "_" + i-->Line_32 $$ PutMappingResponse response = client1.admin().indices().preparePutMapping(indexName).setType(typeName).setSource(JsonXContent.contentBuilder().startObject().startObject(typeName).startObject("properties").startObject(fieldName).field("type", "string").endObject().endObject().endObject().endObject()).get()[ FD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_10 $$ final CyclicBarrier barrier = new CyclicBarrier(threads.length)[ CD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_28 $$ Client client2 = clientArray.get((i + 1) % clientArray.size())[ CD ]
Line_28 $$ Client client2 = clientArray.get((i + 1) % clientArray.size())-->Line_34 $$ GetMappingsResponse getMappingResponse = client2.admin().indices().prepareGetMappings(indexName).get()[ FD ]
Line_10 $$ final CyclicBarrier barrier = new CyclicBarrier(threads.length)-->Line_22 $$ barrier.await()[ FD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_37 $$ assertThat(((Map<String, Object>) mappings.get(typeName).getSourceAsMap().get("properties")).keySet(), Matchers.hasItem(fieldName))[ CD ]
Line_12 $$ for (Client c : clients()) -->Line_13 $$ clientArray.add(c)[ FD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_31 $$ String fieldName = Thread.currentThread().getName() + "_" + i[ CD ]
Line_29 $$ String indexName = i % 2 == 0 ? "test2" : "test1"-->Line_32 $$ PutMappingResponse response = client1.admin().indices().preparePutMapping(indexName).setType(typeName).setSource(JsonXContent.contentBuilder().startObject().startObject(typeName).startObject("properties").startObject(fieldName).field("type", "string").endObject().endObject().endObject().endObject()).get()[ FD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_15 $$ for (int j = 0; j < threads.length; j++) [ CD ]
Line_8 $$ final AtomicBoolean stop = new AtomicBoolean(false)-->Line_41 $$ stop.set(true)[ FD ]
Line_11 $$ final ArrayList<Client> clientArray = new ArrayList()-->Line_13 $$ clientArray.add(c)[ FD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_7 $$ final Throwable[] threadException = new Throwable[1][ CD ]
Line_30 $$ String typeName = "type" + (i % 10)-->Line_37 $$ assertThat(((Map<String, Object>) mappings.get(typeName).getSourceAsMap().get("properties")).keySet(), Matchers.hasItem(fieldName))[ FD ]
Line_8 $$ final AtomicBoolean stop = new AtomicBoolean(false)-->Line_24 $$ if (stop.get()) [ FD ]
Line_15 $$ for (int j = 0; j < threads.length; j++) -->Line_45 $$ threads[j].setName("t_" + j)[ CD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_29 $$ String indexName = i % 2 == 0 ? "test2" : "test1"[ CD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_3 $$ createIndex("test1", "test2")[ CD ]
Line_15 $$ for (int j = 0; j < threads.length; j++) -->Line_16 $$ threads[j] = new Thread(new Runnable() [ CD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_34 $$ GetMappingsResponse getMappingResponse = client2.admin().indices().prepareGetMappings(indexName).get()[ CD ]
Line_30 $$ String typeName = "type" + (i % 10)-->Line_36 $$ assertThat(mappings.containsKey(typeName), equalTo(true))[ FD ]
Line_35 $$ ImmutableOpenMap<String, MappingMetaData> mappings = getMappingResponse.getMappings().get(indexName)-->Line_36 $$ assertThat(mappings.containsKey(typeName), equalTo(true))[ FD ]
Line_11 $$ final ArrayList<Client> clientArray = new ArrayList()-->Line_28 $$ Client client2 = clientArray.get((i + 1) % clientArray.size())[ FD ]
Line_31 $$ String fieldName = Thread.currentThread().getName() + "_" + i-->Line_37 $$ assertThat(((Map<String, Object>) mappings.get(typeName).getSourceAsMap().get("properties")).keySet(), Matchers.hasItem(fieldName))[ FD ]
Line_15 $$ for (int j = 0; j < threads.length; j++) -->Line_46 $$ threads[j].start()[ CD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_30 $$ String typeName = "type" + (i % 10)[ CD ]
Line_23 $$ for (int i = 0; i < 100; i++) -->Line_24 $$ if (stop.get()) [ CD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_11 $$ final ArrayList<Client> clientArray = new ArrayList()[ CD ]
Line_27 $$ Client client1 = clientArray.get(i % clientArray.size())-->Line_32 $$ PutMappingResponse response = client1.admin().indices().preparePutMapping(indexName).setType(typeName).setSource(JsonXContent.contentBuilder().startObject().startObject(typeName).startObject("properties").startObject(fieldName).field("type", "string").endObject().endObject().endObject().endObject()).get()[ FD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_9 $$ Thread[] threads = new Thread[3][ CD ]
Line_2 $$ public void testUpdateMappingConcurrently() throws Throwable -->Line_49 $$ if (threadException[0] != null) [ CD ]
